{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _parseInt from \"@babel/runtime-corejs3/core-js-stable/parse-int\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport Split from 'react-split';\nimport { styled, useTheme } from '@superset-ui/core';\nimport { useResizeDetector } from 'react-resize-detector';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport ChartContainer from 'src/chart/ChartContainer';\nimport ConnectedExploreChartHeader from './ExploreChartHeader';\nimport { DataTablesPane } from './DataTablesPane';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  addHistory: PropTypes.func,\n  onQuery: PropTypes.func,\n  can_overwrite: PropTypes.bool.isRequired,\n  can_download: PropTypes.bool.isRequired,\n  datasource: PropTypes.object,\n  column_formats: PropTypes.object,\n  containerId: PropTypes.string.isRequired,\n  height: PropTypes.string.isRequired,\n  width: PropTypes.string.isRequired,\n  isStarred: PropTypes.bool.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  table_name: PropTypes.string,\n  vizType: PropTypes.string.isRequired,\n  form_data: PropTypes.object,\n  standalone: PropTypes.bool,\n  timeout: PropTypes.number,\n  refreshOverlayVisible: PropTypes.bool,\n  chart: chartPropShape,\n  errorMessage: PropTypes.node,\n  triggerRender: PropTypes.bool };\n\n\nconst GUTTER_SIZE_FACTOR = 1.25;\n\nconst CHART_PANEL_PADDING = 30;\nconst HEADER_PADDING = 15;\n\nconst INITIAL_SIZES = [90, 10];\nconst MIN_SIZES = [300, 50];\nconst DEFAULT_SOUTH_PANE_HEIGHT_PERCENT = 40;\n\nconst Styles = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  align-content: stretch;\n  overflow: auto;\n  box-shadow: none;\n  height: 100%;\n\n  & > div:last-of-type {\n    flex-basis: 100%;\n  }\n\n  .gutter {\n    border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    width: ${({ theme }) => theme.gridUnit * 9}px;\n    margin: ${({ theme }) => theme.gridUnit * GUTTER_SIZE_FACTOR}px auto;\n  }\n\n  .gutter.gutter-vertical {\n    cursor: row-resize;\n  }\n\n  .ant-collapse {\n    .ant-tabs {\n      height: 100%;\n      .ant-tabs-nav {\n        padding-left: ${({ theme }) => theme.gridUnit * 5}px;\n        margin: 0;\n      }\n      .ant-tabs-content-holder {\n        overflow: hidden;\n        .ant-tabs-content {\n          height: 100%;\n        }\n      }\n    }\n  }\n`;\n\nconst ExploreChartPanel = props => {\n  const theme = useTheme();\n  const gutterMargin = theme.gridUnit * GUTTER_SIZE_FACTOR;\n  const gutterHeight = theme.gridUnit * GUTTER_SIZE_FACTOR;\n\n  const { height: hHeight, ref: headerRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300 });\n\n  const { width: chartWidth, ref: chartRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300 });\n\n  const [splitSizes, setSplitSizes] = useState(INITIAL_SIZES);\n\n  const calcSectionHeight = useCallback(\n  percent => {\n    let headerHeight;\n    if (props.standalone) {\n      headerHeight = 0;\n    } else if (hHeight) {\n      headerHeight = hHeight + HEADER_PADDING;\n    } else {\n      headerHeight = 50;\n    }\n    const containerHeight = _parseInt(props.height, 10) - headerHeight;\n    return (\n      containerHeight * percent / 100 - (gutterHeight / 2 + gutterMargin));\n\n  },\n  [gutterHeight, gutterMargin, props.height, props.standalone, hHeight]);\n\n\n  const [tableSectionHeight, setTableSectionHeight] = useState(\n  calcSectionHeight(INITIAL_SIZES[1]));\n\n\n  const recalcPanelSizes = useCallback(\n  ([, southPercent]) => {\n    setTableSectionHeight(calcSectionHeight(southPercent));\n  },\n  [calcSectionHeight]);\n\n\n  useEffect(() => {\n    recalcPanelSizes(splitSizes);\n  }, [recalcPanelSizes, splitSizes]);\n\n  const onDragEnd = sizes => {\n    setSplitSizes(sizes);\n  };\n\n  const onCollapseChange = openPanelName => {\n    let splitSizes;\n    if (!openPanelName) {\n      splitSizes = INITIAL_SIZES;\n    } else {\n      splitSizes = [\n      100 - DEFAULT_SOUTH_PANE_HEIGHT_PERCENT,\n      DEFAULT_SOUTH_PANE_HEIGHT_PERCENT];\n\n    }\n    setSplitSizes(splitSizes);\n  };\n\n  const renderChart = useCallback(() => {var _props$slice;\n    const { chart } = props;\n    const newHeight = calcSectionHeight(splitSizes[0]) - CHART_PANEL_PADDING;\n    return (\n      chartWidth > 0 &&\n      ___EmotionJSX(ChartContainer, {\n        width: Math.floor(chartWidth),\n        height: newHeight,\n        annotationData: chart.annotationData,\n        chartAlert: chart.chartAlert,\n        chartStackTrace: chart.chartStackTrace,\n        chartId: chart.id,\n        chartStatus: chart.chartStatus,\n        triggerRender: props.triggerRender,\n        datasource: props.datasource,\n        errorMessage: props.errorMessage,\n        formData: props.form_data,\n        onQuery: props.onQuery,\n        owners: props == null ? void 0 : (_props$slice = _sliceInstanceProperty(props)) == null ? void 0 : _props$slice.owners,\n        queriesResponse: chart.queriesResponse,\n        refreshOverlayVisible: props.refreshOverlayVisible,\n        setControlValue: props.actions.setControlValue,\n        timeout: props.timeout,\n        triggerQuery: chart.triggerQuery,\n        vizType: props.vizType }));\n\n\n\n  }, [calcSectionHeight, chartWidth, props, splitSizes]);\n\n  const panelBody = useMemo(\n  () =>\n  ___EmotionJSX(\"div\", { className: \"panel-body\", ref: chartRef },\n  renderChart()),\n\n\n  [chartRef, renderChart]);\n\n\n  const standaloneChartBody = useMemo(\n  () => ___EmotionJSX(\"div\", { ref: chartRef }, renderChart()),\n  [chartRef, renderChart]);\n\n\n  if (props.standalone) {\n    // dom manipulation hack to get rid of the boostrap theme's body background\n    const standaloneClass = 'background-transparent';\n    const bodyClasses = document.body.className.split(' ');\n    if (!_includesInstanceProperty(bodyClasses).call(bodyClasses, standaloneClass)) {\n      document.body.className += ` ${standaloneClass}`;\n    }\n    return standaloneChartBody;\n  }\n\n  const header =\n  ___EmotionJSX(ConnectedExploreChartHeader, {\n    actions: props.actions,\n    addHistory: props.addHistory,\n    can_overwrite: props.can_overwrite,\n    can_download: props.can_download,\n    chartHeight: props.height,\n    isStarred: props.isStarred,\n    slice: _sliceInstanceProperty(props),\n    sliceName: props.sliceName,\n    table_name: props.table_name,\n    form_data: props.form_data,\n    timeout: props.timeout,\n    chart: props.chart });\n\n\n\n  const elementStyle = (dimension, elementSize, gutterSize) => ({\n    [dimension]: `calc(${elementSize}% - ${gutterSize + gutterMargin}px)` });\n\n\n  return (\n    ___EmotionJSX(Styles, { className: \"panel panel-default chart-container\" },\n    ___EmotionJSX(\"div\", { className: \"panel-heading\", ref: headerRef },\n    header),\n\n    props.vizType === 'filter_box' ?\n    panelBody :\n\n    ___EmotionJSX(Split, {\n      sizes: splitSizes,\n      minSize: MIN_SIZES,\n      direction: \"vertical\",\n      gutterSize: gutterHeight,\n      onDragEnd: onDragEnd,\n      elementStyle: elementStyle },\n\n    panelBody,\n    ___EmotionJSX(DataTablesPane, {\n      queryFormData: props.chart.latestQueryFormData,\n      tableSectionHeight: tableSectionHeight,\n      onCollapseChange: onCollapseChange }))));\n\n\n\n\n\n};__signature__(ExploreChartPanel, \"useTheme{theme}\\nuseResizeDetector{{ height: hHeight, ref: headerRef }}\\nuseResizeDetector{{ width: chartWidth, ref: chartRef }}\\nuseState{[splitSizes, setSplitSizes](INITIAL_SIZES)}\\nuseCallback{calcSectionHeight}\\nuseState{[tableSectionHeight, setTableSectionHeight](calcSectionHeight(INITIAL_SIZES[1]))}\\nuseCallback{recalcPanelSizes}\\nuseEffect{}\\nuseCallback{renderChart}\\nuseMemo{panelBody}\\nuseMemo{standaloneChartBody}\", () => [useTheme, useResizeDetector, useResizeDetector]);\n\nExploreChartPanel.propTypes = propTypes;const _default =\n\nExploreChartPanel;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(GUTTER_SIZE_FACTOR, \"GUTTER_SIZE_FACTOR\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(CHART_PANEL_PADDING, \"CHART_PANEL_PADDING\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(HEADER_PADDING, \"HEADER_PADDING\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(INITIAL_SIZES, \"INITIAL_SIZES\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(MIN_SIZES, \"MIN_SIZES\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(DEFAULT_SOUTH_PANE_HEIGHT_PERCENT, \"DEFAULT_SOUTH_PANE_HEIGHT_PERCENT\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(Styles, \"Styles\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(ExploreChartPanel, \"ExploreChartPanel\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx"],"names":["React","useState","useEffect","useCallback","useMemo","PropTypes","Split","styled","useTheme","useResizeDetector","chartPropShape","ChartContainer","ConnectedExploreChartHeader","DataTablesPane","propTypes","actions","object","isRequired","addHistory","func","onQuery","can_overwrite","bool","can_download","datasource","column_formats","containerId","string","height","width","isStarred","slice","sliceName","table_name","vizType","form_data","standalone","timeout","number","refreshOverlayVisible","chart","errorMessage","node","triggerRender","GUTTER_SIZE_FACTOR","CHART_PANEL_PADDING","HEADER_PADDING","INITIAL_SIZES","MIN_SIZES","DEFAULT_SOUTH_PANE_HEIGHT_PERCENT","Styles","div","theme","colors","grayscale","light2","gridUnit","ExploreChartPanel","props","gutterMargin","gutterHeight","hHeight","ref","headerRef","refreshMode","refreshRate","chartWidth","chartRef","splitSizes","setSplitSizes","calcSectionHeight","percent","headerHeight","containerHeight","tableSectionHeight","setTableSectionHeight","recalcPanelSizes","southPercent","onDragEnd","sizes","onCollapseChange","openPanelName","renderChart","newHeight","Math","floor","annotationData","chartAlert","chartStackTrace","id","chartStatus","owners","queriesResponse","setControlValue","triggerQuery","panelBody","standaloneChartBody","standaloneClass","bodyClasses","document","body","className","split","header","elementStyle","dimension","elementSize","gutterSize","latestQueryFormData"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport Split from 'react-split';\nimport { styled, useTheme } from '@superset-ui/core';\nimport { useResizeDetector } from 'react-resize-detector';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport ChartContainer from 'src/chart/ChartContainer';\nimport ConnectedExploreChartHeader from './ExploreChartHeader';\nimport { DataTablesPane } from './DataTablesPane';\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  addHistory: PropTypes.func,\n  onQuery: PropTypes.func,\n  can_overwrite: PropTypes.bool.isRequired,\n  can_download: PropTypes.bool.isRequired,\n  datasource: PropTypes.object,\n  column_formats: PropTypes.object,\n  containerId: PropTypes.string.isRequired,\n  height: PropTypes.string.isRequired,\n  width: PropTypes.string.isRequired,\n  isStarred: PropTypes.bool.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  table_name: PropTypes.string,\n  vizType: PropTypes.string.isRequired,\n  form_data: PropTypes.object,\n  standalone: PropTypes.bool,\n  timeout: PropTypes.number,\n  refreshOverlayVisible: PropTypes.bool,\n  chart: chartPropShape,\n  errorMessage: PropTypes.node,\n  triggerRender: PropTypes.bool,\n};\n\nconst GUTTER_SIZE_FACTOR = 1.25;\n\nconst CHART_PANEL_PADDING = 30;\nconst HEADER_PADDING = 15;\n\nconst INITIAL_SIZES = [90, 10];\nconst MIN_SIZES = [300, 50];\nconst DEFAULT_SOUTH_PANE_HEIGHT_PERCENT = 40;\n\nconst Styles = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  align-content: stretch;\n  overflow: auto;\n  box-shadow: none;\n  height: 100%;\n\n  & > div:last-of-type {\n    flex-basis: 100%;\n  }\n\n  .gutter {\n    border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    width: ${({ theme }) => theme.gridUnit * 9}px;\n    margin: ${({ theme }) => theme.gridUnit * GUTTER_SIZE_FACTOR}px auto;\n  }\n\n  .gutter.gutter-vertical {\n    cursor: row-resize;\n  }\n\n  .ant-collapse {\n    .ant-tabs {\n      height: 100%;\n      .ant-tabs-nav {\n        padding-left: ${({ theme }) => theme.gridUnit * 5}px;\n        margin: 0;\n      }\n      .ant-tabs-content-holder {\n        overflow: hidden;\n        .ant-tabs-content {\n          height: 100%;\n        }\n      }\n    }\n  }\n`;\n\nconst ExploreChartPanel = props => {\n  const theme = useTheme();\n  const gutterMargin = theme.gridUnit * GUTTER_SIZE_FACTOR;\n  const gutterHeight = theme.gridUnit * GUTTER_SIZE_FACTOR;\n\n  const { height: hHeight, ref: headerRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300,\n  });\n  const { width: chartWidth, ref: chartRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300,\n  });\n  const [splitSizes, setSplitSizes] = useState(INITIAL_SIZES);\n\n  const calcSectionHeight = useCallback(\n    percent => {\n      let headerHeight;\n      if (props.standalone) {\n        headerHeight = 0;\n      } else if (hHeight) {\n        headerHeight = hHeight + HEADER_PADDING;\n      } else {\n        headerHeight = 50;\n      }\n      const containerHeight = parseInt(props.height, 10) - headerHeight;\n      return (\n        (containerHeight * percent) / 100 - (gutterHeight / 2 + gutterMargin)\n      );\n    },\n    [gutterHeight, gutterMargin, props.height, props.standalone, hHeight],\n  );\n\n  const [tableSectionHeight, setTableSectionHeight] = useState(\n    calcSectionHeight(INITIAL_SIZES[1]),\n  );\n\n  const recalcPanelSizes = useCallback(\n    ([, southPercent]) => {\n      setTableSectionHeight(calcSectionHeight(southPercent));\n    },\n    [calcSectionHeight],\n  );\n\n  useEffect(() => {\n    recalcPanelSizes(splitSizes);\n  }, [recalcPanelSizes, splitSizes]);\n\n  const onDragEnd = sizes => {\n    setSplitSizes(sizes);\n  };\n\n  const onCollapseChange = openPanelName => {\n    let splitSizes;\n    if (!openPanelName) {\n      splitSizes = INITIAL_SIZES;\n    } else {\n      splitSizes = [\n        100 - DEFAULT_SOUTH_PANE_HEIGHT_PERCENT,\n        DEFAULT_SOUTH_PANE_HEIGHT_PERCENT,\n      ];\n    }\n    setSplitSizes(splitSizes);\n  };\n\n  const renderChart = useCallback(() => {\n    const { chart } = props;\n    const newHeight = calcSectionHeight(splitSizes[0]) - CHART_PANEL_PADDING;\n    return (\n      chartWidth > 0 && (\n        <ChartContainer\n          width={Math.floor(chartWidth)}\n          height={newHeight}\n          annotationData={chart.annotationData}\n          chartAlert={chart.chartAlert}\n          chartStackTrace={chart.chartStackTrace}\n          chartId={chart.id}\n          chartStatus={chart.chartStatus}\n          triggerRender={props.triggerRender}\n          datasource={props.datasource}\n          errorMessage={props.errorMessage}\n          formData={props.form_data}\n          onQuery={props.onQuery}\n          owners={props?.slice?.owners}\n          queriesResponse={chart.queriesResponse}\n          refreshOverlayVisible={props.refreshOverlayVisible}\n          setControlValue={props.actions.setControlValue}\n          timeout={props.timeout}\n          triggerQuery={chart.triggerQuery}\n          vizType={props.vizType}\n        />\n      )\n    );\n  }, [calcSectionHeight, chartWidth, props, splitSizes]);\n\n  const panelBody = useMemo(\n    () => (\n      <div className=\"panel-body\" ref={chartRef}>\n        {renderChart()}\n      </div>\n    ),\n    [chartRef, renderChart],\n  );\n\n  const standaloneChartBody = useMemo(\n    () => <div ref={chartRef}>{renderChart()}</div>,\n    [chartRef, renderChart],\n  );\n\n  if (props.standalone) {\n    // dom manipulation hack to get rid of the boostrap theme's body background\n    const standaloneClass = 'background-transparent';\n    const bodyClasses = document.body.className.split(' ');\n    if (!bodyClasses.includes(standaloneClass)) {\n      document.body.className += ` ${standaloneClass}`;\n    }\n    return standaloneChartBody;\n  }\n\n  const header = (\n    <ConnectedExploreChartHeader\n      actions={props.actions}\n      addHistory={props.addHistory}\n      can_overwrite={props.can_overwrite}\n      can_download={props.can_download}\n      chartHeight={props.height}\n      isStarred={props.isStarred}\n      slice={props.slice}\n      sliceName={props.sliceName}\n      table_name={props.table_name}\n      form_data={props.form_data}\n      timeout={props.timeout}\n      chart={props.chart}\n    />\n  );\n\n  const elementStyle = (dimension, elementSize, gutterSize) => ({\n    [dimension]: `calc(${elementSize}% - ${gutterSize + gutterMargin}px)`,\n  });\n\n  return (\n    <Styles className=\"panel panel-default chart-container\">\n      <div className=\"panel-heading\" ref={headerRef}>\n        {header}\n      </div>\n      {props.vizType === 'filter_box' ? (\n        panelBody\n      ) : (\n        <Split\n          sizes={splitSizes}\n          minSize={MIN_SIZES}\n          direction=\"vertical\"\n          gutterSize={gutterHeight}\n          onDragEnd={onDragEnd}\n          elementStyle={elementStyle}\n        >\n          {panelBody}\n          <DataTablesPane\n            queryFormData={props.chart.latestQueryFormData}\n            tableSectionHeight={tableSectionHeight}\n            onCollapseChange={onCollapseChange}\n          />\n        </Split>\n      )}\n    </Styles>\n  );\n};\n\nExploreChartPanel.propTypes = propTypes;\n\nexport default ExploreChartPanel;\n"]},"metadata":{},"sourceType":"module"}