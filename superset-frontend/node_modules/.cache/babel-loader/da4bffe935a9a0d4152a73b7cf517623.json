{"ast":null,"code":"import \"core-js/modules/es.string.replace.js\";import \"core-js/modules/web.dom-collections.iterator.js\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";import _Object$freeze from \"@babel/runtime-corejs3/core-js-stable/object/freeze\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { FormControl, FormGroup, InputGroup, Radio } from 'react-bootstrap';\nimport { Tooltip } from 'src/common/components/Tooltip';\nimport Popover from 'src/common/components/Popover';\nimport { Select, Input } from 'src/common/components';\nimport Button from 'src/components/Button';\nimport Datetime from 'react-datetime';\nimport 'react-datetime/css/react-datetime.css';\nimport moment from 'moment';\nimport { t, styled, withTheme } from '@superset-ui/core';\n\nimport Tabs from 'src/common/components/Tabs';\nimport {\nbuildTimeRangeString,\nformatTimeRange } from\n'src/explore/dateFilterUtils';\nimport Label from 'src/components/Label';\nimport './DateFilterControl.less';\nimport ControlHeader from '../ControlHeader';\nimport PopoverSection from '../../../components/PopoverSection';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst TYPES = _Object$freeze({\n  DEFAULTS: 'defaults',\n  CUSTOM_START_END: 'custom_start_end',\n  CUSTOM_RANGE: 'custom_range' });\n\nconst TABS = _Object$freeze({\n  DEFAULTS: 'defaults',\n  CUSTOM: 'custom' });\n\nconst RELATIVE_TIME_OPTIONS = _Object$freeze({\n  LAST: 'Last',\n  NEXT: 'Next' });\n\nconst COMMON_TIME_FRAMES = [\n'Last day',\n'Last week',\n'Last month',\n'Last quarter',\n'Last year',\n'No filter'];\n\nconst TIME_GRAIN_OPTIONS = [\n'seconds',\n'minutes',\n'hours',\n'days',\n'weeks',\n'months',\n'years'];\n\n\nconst MOMENT_FORMAT = 'YYYY-MM-DD[T]HH:mm:ss';\nconst DEFAULT_SINCE = moment().\nutc().\nstartOf('day').\nsubtract(7, 'days').\nformat(MOMENT_FORMAT);\nconst DEFAULT_UNTIL = moment().utc().startOf('day').format(MOMENT_FORMAT);\nconst SEPARATOR = ' : ';\nconst FREEFORM_TOOLTIP = t(\n'Superset supports smart date parsing. Strings like `3 weeks ago`, `last sunday`, or ' +\n'`2 weeks from now` can be used.');\n\n\nconst propTypes = {\n  animation: PropTypes.bool,\n  name: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  height: PropTypes.number,\n  onOpenDateFilterControl: PropTypes.func,\n  onCloseDateFilterControl: PropTypes.func,\n  endpoints: PropTypes.arrayOf(PropTypes.string) };\n\n\nconst defaultProps = {\n  animation: true,\n  onChange: () => {},\n  value: 'Last week',\n  onOpenDateFilterControl: () => {},\n  onCloseDateFilterControl: () => {} };\n\n\nfunction isValidMoment(s) {\n  /* Moment sometimes consider invalid dates as valid, eg, \"10 years ago\" gets\n   * parsed as \"Fri Jan 01 2010 00:00:00\" local time. This function does a\n   * better check by comparing a string with a parse/format roundtrip.\n   */\n  return s === moment(s, MOMENT_FORMAT).format(MOMENT_FORMAT);\n}\n\nfunction getStateFromSeparator(value) {\n  const [since, until] = value.split(SEPARATOR, 2);\n  return { since, until, type: TYPES.CUSTOM_START_END, tab: TABS.CUSTOM };\n}\n\nfunction getStateFromCommonTimeFrame(value) {\n  const units = `${value.split(' ')[1]}s`;\n  let sinceMoment;\n\n  if (value === 'No filter') {\n    sinceMoment = '';\n  } else if (units === 'years') {\n    sinceMoment = moment().utc().startOf(units).subtract(1, units);\n  } else {\n    sinceMoment = moment().utc().startOf('day').subtract(1, units);\n  }\n\n  return {\n    tab: TABS.DEFAULTS,\n    type: TYPES.DEFAULTS,\n    common: value,\n    since: sinceMoment === '' ? '' : sinceMoment.format(MOMENT_FORMAT),\n    until:\n    sinceMoment === '' ? '' : sinceMoment.add(1, units).format(MOMENT_FORMAT) };\n\n}\n\nfunction getStateFromCustomRange(value) {\n  const [rel, num, grain] = value.split(' ', 3);\n  let since;\n  let until;\n  if (rel === RELATIVE_TIME_OPTIONS.LAST) {\n    until = moment().utc().startOf('day').format(MOMENT_FORMAT);\n    since = moment().\n    utc().\n    startOf('day').\n    subtract(num, grain).\n    format(MOMENT_FORMAT);\n  } else {\n    until = moment().utc().startOf('day').add(num, grain).format(MOMENT_FORMAT);\n    since = moment().startOf('day').format(MOMENT_FORMAT);\n  }\n  return {\n    tab: TABS.CUSTOM,\n    type: TYPES.CUSTOM_RANGE,\n    common: null,\n    rel,\n    num,\n    grain,\n    since,\n    until };\n\n}\n\nconst TimeFramesStyles = styled.div`\n  .radio {\n    margin: ${({ theme }) => theme.gridUnit}px 0;\n  }\n`;\n\nconst PopoverContentStyles = styled.div`\n  width: ${({ theme }) => theme.gridUnit * 60}px;\n\n  .timeframes-container {\n    margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n\n  .relative-timerange-container {\n    display: flex;\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n\n  .timerange-input {\n    width: ${({ theme }) => theme.gridUnit * 15}px;\n    margin: 0 ${({ theme }) => theme.gridUnit}px;\n  }\n\n  .datetime {\n    margin: ${({ theme }) => theme.gridUnit}px 0;\n  }\n\n  .ant-tabs {\n    overflow: visible;\n    & > .ant-tabs-content-holder {\n      overflow: visible;\n    }\n  }\n`;\n\nclass DateFilterControl extends React.Component {\n  constructor(props) {var _context, _context2, _context3, _context4, _context5, _context6, _context7, _context8, _context9, _context10, _context11, _context12, _context13;\n    super(props);\n    this.state = {\n      type: TYPES.DEFAULTS,\n      tab: TABS.DEFAULTS,\n\n      // default time frames, for convenience\n      common: COMMON_TIME_FRAMES[0],\n\n      // \"last 7 days\", \"next 4 weeks\", etc.\n      rel: RELATIVE_TIME_OPTIONS.LAST,\n      num: '7',\n      grain: TIME_GRAIN_OPTIONS[3],\n\n      // distinct start/end values, either ISO or freeform\n      since: DEFAULT_SINCE,\n      until: DEFAULT_UNTIL,\n\n      // react-datetime has a `closeOnSelect` prop, but it's buggy... so we\n      // handle the calendar visibility here ourselves\n      showSinceCalendar: false,\n      showUntilCalendar: false,\n      sinceViewMode: 'days',\n      untilViewMode: 'days',\n\n      popoverVisible: false };\n\n\n    const { value } = props;\n    if (value && _indexOfInstanceProperty(value).call(value, SEPARATOR) >= 0) {\n      this.state = { ...this.state, ...getStateFromSeparator(value) };\n    } else if (_indexOfInstanceProperty(COMMON_TIME_FRAMES).call(COMMON_TIME_FRAMES, value) >= 0) {\n      this.state = { ...this.state, ...getStateFromCommonTimeFrame(value) };\n    } else if (value) {\n      this.state = { ...this.state, ...getStateFromCustomRange(value) };\n    }\n\n    this.close = _bindInstanceProperty(_context = this.close).call(_context, this);\n    this.handleClick = _bindInstanceProperty(_context2 = this.handleClick).call(_context2, this);\n    this.isValidSince = _bindInstanceProperty(_context3 = this.isValidSince).call(_context3, this);\n    this.isValidUntil = _bindInstanceProperty(_context4 = this.isValidUntil).call(_context4, this);\n    this.onEnter = _bindInstanceProperty(_context5 = this.onEnter).call(_context5, this);\n    this.renderInput = _bindInstanceProperty(_context6 = this.renderInput).call(_context6, this);\n    this.setCustomRange = _bindInstanceProperty(_context7 = this.setCustomRange).call(_context7, this);\n    this.setCustomStartEnd = _bindInstanceProperty(_context8 = this.setCustomStartEnd).call(_context8, this);\n    this.setTypeCustomRange = _bindInstanceProperty(_context9 = this.setTypeCustomRange).call(_context9, this);\n    this.setTypeCustomStartEnd = _bindInstanceProperty(_context10 = this.setTypeCustomStartEnd).call(_context10, this);\n    this.toggleCalendar = _bindInstanceProperty(_context11 = this.toggleCalendar).call(_context11, this);\n    this.changeTab = _bindInstanceProperty(_context12 = this.changeTab).call(_context12, this);\n    this.handleVisibleChange = _bindInstanceProperty(_context13 = this.handleVisibleChange).call(_context13, this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('click', this.handleClick);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('click', this.handleClick);\n  }\n\n  onEnter(event) {\n    if (event.key === 'Enter') {\n      this.close();\n    }\n  }\n\n  setCustomRange(key, value) {\n    const updatedState = { ...this.state, [key]: value };\n    const combinedValue = [\n    updatedState.rel,\n    updatedState.num,\n    updatedState.grain].\n    join(' ');\n    this.setState(getStateFromCustomRange(combinedValue));\n  }\n\n  setCustomStartEnd(key, value) {\n    const closeCalendar =\n    key === 'since' && this.state.sinceViewMode === 'days' ||\n    key === 'until' && this.state.untilViewMode === 'days';\n    this.setState(prevState => ({\n      type: TYPES.CUSTOM_START_END,\n      [key]: typeof value === 'string' ? value : value.format(MOMENT_FORMAT),\n      showSinceCalendar: prevState.showSinceCalendar && !closeCalendar,\n      showUntilCalendar: prevState.showUntilCalendar && !closeCalendar,\n      sinceViewMode: closeCalendar ? 'days' : prevState.sinceViewMode,\n      untilViewMode: closeCalendar ? 'days' : prevState.untilViewMode }));\n\n  }\n\n  setTypeCustomRange() {\n    this.setState({ type: TYPES.CUSTOM_RANGE });\n  }\n\n  setTypeCustomStartEnd() {\n    this.setState({ type: TYPES.CUSTOM_START_END });\n  }\n\n  changeTab() {\n    const { tab } = this.state;\n    if (tab === TABS.CUSTOM) {\n      this.setState({ tab: TABS.DEFAULTS });\n    } else if (tab === TABS.DEFAULTS) {\n      this.setState({ tab: TABS.CUSTOM });\n    }\n  }\n\n  handleClick(e) {\n    const { target } = e;\n    // switch to `TYPES.CUSTOM_START_END` when the calendar is clicked\n    if (this.startEndSectionRef && this.startEndSectionRef.contains(target)) {\n      this.setTypeCustomStartEnd();\n    }\n\n    // if user click outside popover, popover will hide and we will call onCloseDateFilterControl,\n    // but need to exclude OverlayTrigger component to avoid handle click events twice.\n    if (target.getAttribute('name') !== 'popover-trigger') {\n      if (this.popoverContainer && !this.popoverContainer.contains(target)) {\n        this.props.onCloseDateFilterControl();\n      }\n    }\n  }\n\n  close() {\n    let val;\n    if (\n    this.state.type === TYPES.DEFAULTS ||\n    this.state.tab === TABS.DEFAULTS)\n    {\n      val = this.state.common;\n    } else if (this.state.type === TYPES.CUSTOM_RANGE) {\n      val = `${this.state.rel} ${this.state.num} ${this.state.grain}`;\n    } else {\n      val = [this.state.since, this.state.until].join(SEPARATOR);\n    }\n    this.props.onCloseDateFilterControl();\n    this.props.onChange(val);\n    this.setState({\n      showSinceCalendar: false,\n      showUntilCalendar: false,\n      popoverVisible: false });\n\n  }\n\n  isValidSince(date) {\n    return (\n      !isValidMoment(this.state.until) ||\n      date <= moment(this.state.until, MOMENT_FORMAT));\n\n  }\n\n  isValidUntil(date) {\n    return (\n      !isValidMoment(this.state.since) ||\n      date >= moment(this.state.since, MOMENT_FORMAT));\n\n  }\n\n  toggleCalendar(key) {\n    const nextState = {};\n    if (key === 'showSinceCalendar') {\n      nextState.showSinceCalendar = !this.state.showSinceCalendar;\n      if (!this.state.showSinceCalendar) {\n        nextState.showUntilCalendar = false;\n      }\n    } else if (key === 'showUntilCalendar') {\n      nextState.showUntilCalendar = !this.state.showUntilCalendar;\n      if (!this.state.showUntilCalendar) {\n        nextState.showSinceCalendar = false;\n      }\n    }\n    this.setState(nextState);\n  }\n\n  handleVisibleChange(visible) {\n    if (visible) {\n      this.props.onOpenDateFilterControl();\n    } else {\n      this.props.onCloseDateFilterControl();\n    }\n    this.setState({ popoverVisible: visible });\n  }\n\n  renderInput(props, key) {\n    return (\n      ___EmotionJSX(FormGroup, null,\n      ___EmotionJSX(InputGroup, { bsSize: \"small\" },\n      ___EmotionJSX(FormControl, _extends({},\n      props, {\n        type: \"text\",\n        onKeyPress: this.onEnter,\n        onFocus: this.setTypeCustomStartEnd,\n        onClick: () => {} })),\n\n      ___EmotionJSX(InputGroup.Button, { onClick: () => this.toggleCalendar(key) },\n      ___EmotionJSX(Button, null,\n      ___EmotionJSX(\"i\", { className: \"fa fa-calendar\" }))))));\n\n\n\n\n\n  }\n\n  renderPopover() {\n    const grainOptions = _mapInstanceProperty(TIME_GRAIN_OPTIONS).call(TIME_GRAIN_OPTIONS, (grain) =>\n    ___EmotionJSX(Select.Option, {\n      key: grain,\n      value: grain,\n      active: grain === this.state.grain },\n\n    grain));\n\n\n    const timeFrames = _mapInstanceProperty(COMMON_TIME_FRAMES).call(COMMON_TIME_FRAMES, timeFrame => {\n      const nextState = getStateFromCommonTimeFrame(timeFrame);\n      const timeRange = buildTimeRangeString(nextState.since, nextState.until);\n\n      return (\n        ___EmotionJSX(TimeFramesStyles, { key: timeFrame },\n        ___EmotionJSX(Tooltip, {\n          id: `tooltip-${timeFrame}`,\n          key: timeFrame,\n          placement: \"right\",\n          title: formatTimeRange(timeRange, this.props.endpoints) },\n\n        ___EmotionJSX(\"div\", { style: { display: 'inline-block' } },\n        ___EmotionJSX(Radio, {\n          key: timeFrame.replace(' ', '').toLowerCase(),\n          checked: this.state.common === timeFrame,\n          onChange: () => this.setState(nextState) },\n\n        timeFrame)))));\n\n\n\n\n\n    });\n\n    return (\n      ___EmotionJSX(PopoverContentStyles, {\n        id: \"filter-popover\",\n        ref: ref => {\n          this.popoverContainer = ref;\n        } },\n\n      ___EmotionJSX(Tabs, {\n        defaultActiveKey: this.state.tab === TABS.DEFAULTS ? '1' : '2',\n        id: \"type\",\n        className: \"time-filter-tabs\",\n        onChange: this.changeTab },\n\n      ___EmotionJSX(Tabs.TabPane, { key: \"1\", tab: \"Defaults\", forceRender: true },\n      ___EmotionJSX(\"div\", { className: \"timeframes-container\" },\n      ___EmotionJSX(FormGroup, null, timeFrames))),\n\n\n      ___EmotionJSX(Tabs.TabPane, { key: \"2\", tab: \"Custom\" },\n      ___EmotionJSX(FormGroup, null,\n      ___EmotionJSX(PopoverSection, {\n        title: \"Relative to today\",\n        isSelected: this.state.type === TYPES.CUSTOM_RANGE,\n        onSelect: this.setTypeCustomRange },\n\n      ___EmotionJSX(\"div\", { className: \"relative-timerange-container clearfix centered\" },\n      ___EmotionJSX(Select, {\n        value: this.state.rel,\n        onSelect: value => this.setCustomRange('rel', value),\n        onFocus: this.setTypeCustomRange },\n\n      ___EmotionJSX(Select.Option, { value: RELATIVE_TIME_OPTIONS.LAST }, \"Last\"),\n\n\n      ___EmotionJSX(Select.Option, { value: RELATIVE_TIME_OPTIONS.NEXT }, \"Next\")),\n\n\n\n      ___EmotionJSX(Input, {\n        className: \"timerange-input\",\n        type: \"text\",\n        onChange: (event) =>\n        this.setCustomRange('num', event.target.value),\n\n        onFocus: this.setTypeCustomRange,\n        onPressEnter: this.close,\n        value: this.state.num }),\n\n      ___EmotionJSX(Select, {\n        value: this.state.grain,\n        onFocus: this.setTypeCustomRange,\n        onSelect: value => this.setCustomRange('grain', value),\n        dropdownMatchSelectWidth: false },\n\n      grainOptions))),\n\n\n\n      ___EmotionJSX(PopoverSection, {\n        title: \"Start / end\",\n        isSelected: this.state.type === TYPES.CUSTOM_START_END,\n        onSelect: this.setTypeCustomStartEnd,\n        info: FREEFORM_TOOLTIP },\n\n      ___EmotionJSX(\"div\", {\n        ref: ref => {\n          this.startEndSectionRef = ref;\n        } },\n\n      ___EmotionJSX(InputGroup, { \"data-test\": \"date-input-group\" },\n      ___EmotionJSX(Datetime, {\n        className: \"datetime\",\n        inputProps: { 'data-test': 'date-from-input' },\n        value: this.state.since,\n        defaultValue: this.state.since,\n        viewDate: this.state.since,\n        onChange: value => this.setCustomStartEnd('since', value),\n        isValidDate: this.isValidSince,\n        onClick: this.setTypeCustomStartEnd,\n        renderInput: (props) =>\n        this.renderInput(props, 'showSinceCalendar'),\n\n        open: this.state.showSinceCalendar,\n        viewMode: this.state.sinceViewMode,\n        onViewModeChange: (sinceViewMode) =>\n        this.setState({ sinceViewMode }) }),\n\n\n      ___EmotionJSX(Datetime, {\n        className: \"datetime\",\n        inputProps: { 'data-test': 'date-to-input' },\n        value: this.state.until,\n        defaultValue: this.state.until,\n        viewDate: this.state.until,\n        onChange: value => this.setCustomStartEnd('until', value),\n        isValidDate: this.isValidUntil,\n        onClick: this.setTypeCustomStartEnd,\n        renderInput: (props) =>\n        this.renderInput(props, 'showUntilCalendar'),\n\n        open: this.state.showUntilCalendar,\n        viewMode: this.state.untilViewMode,\n        onViewModeChange: (untilViewMode) =>\n        this.setState({ untilViewMode }) }))))))),\n\n\n\n\n\n\n\n\n      ___EmotionJSX(\"div\", { className: \"clearfix\" },\n      ___EmotionJSX(Button, {\n        \"data-test\": \"date-ok-button\",\n        buttonSize: \"small\",\n        className: \"float-right ok\",\n        buttonStyle: \"primary\",\n        onClick: this.close }, \"Ok\"))));\n\n\n\n\n\n\n  }\n\n  render() {\n    const timeRange = this.props.value || defaultProps.value;\n    return (\n      ___EmotionJSX(\"div\", null,\n      ___EmotionJSX(ControlHeader, this.props),\n      ___EmotionJSX(Popover, {\n        trigger: \"click\",\n        placement: \"right\",\n        content: this.renderPopover(),\n        visible: this.state.popoverVisible,\n        onVisibleChange: this.handleVisibleChange },\n\n      ___EmotionJSX(Label, {\n        name: \"popover-trigger\",\n        className: \"pointer\",\n        \"data-test\": \"popover-trigger\" },\n\n      formatTimeRange(timeRange, this.props.endpoints)))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}const _default =\nwithTheme(DateFilterControl);export default _default;\n\nDateFilterControl.propTypes = propTypes;\nDateFilterControl.defaultProps = defaultProps;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(TYPES, \"TYPES\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(TABS, \"TABS\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(RELATIVE_TIME_OPTIONS, \"RELATIVE_TIME_OPTIONS\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(COMMON_TIME_FRAMES, \"COMMON_TIME_FRAMES\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(TIME_GRAIN_OPTIONS, \"TIME_GRAIN_OPTIONS\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(MOMENT_FORMAT, \"MOMENT_FORMAT\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(DEFAULT_SINCE, \"DEFAULT_SINCE\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(DEFAULT_UNTIL, \"DEFAULT_UNTIL\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(SEPARATOR, \"SEPARATOR\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(FREEFORM_TOOLTIP, \"FREEFORM_TOOLTIP\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(isValidMoment, \"isValidMoment\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(getStateFromSeparator, \"getStateFromSeparator\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(getStateFromCommonTimeFrame, \"getStateFromCommonTimeFrame\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(getStateFromCustomRange, \"getStateFromCustomRange\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(TimeFramesStyles, \"TimeFramesStyles\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(PopoverContentStyles, \"PopoverContentStyles\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(DateFilterControl, \"DateFilterControl\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/controls/DateFilterControl.jsx"],"names":["React","PropTypes","FormControl","FormGroup","InputGroup","Radio","Tooltip","Popover","Select","Input","Button","Datetime","moment","t","styled","withTheme","Tabs","buildTimeRangeString","formatTimeRange","Label","ControlHeader","PopoverSection","TYPES","DEFAULTS","CUSTOM_START_END","CUSTOM_RANGE","TABS","CUSTOM","RELATIVE_TIME_OPTIONS","LAST","NEXT","COMMON_TIME_FRAMES","TIME_GRAIN_OPTIONS","MOMENT_FORMAT","DEFAULT_SINCE","utc","startOf","subtract","format","DEFAULT_UNTIL","SEPARATOR","FREEFORM_TOOLTIP","propTypes","animation","bool","name","string","isRequired","label","description","onChange","func","value","height","number","onOpenDateFilterControl","onCloseDateFilterControl","endpoints","arrayOf","defaultProps","isValidMoment","s","getStateFromSeparator","since","until","split","type","tab","getStateFromCommonTimeFrame","units","sinceMoment","common","add","getStateFromCustomRange","rel","num","grain","TimeFramesStyles","div","theme","gridUnit","PopoverContentStyles","DateFilterControl","Component","constructor","props","state","showSinceCalendar","showUntilCalendar","sinceViewMode","untilViewMode","popoverVisible","close","handleClick","isValidSince","isValidUntil","onEnter","renderInput","setCustomRange","setCustomStartEnd","setTypeCustomRange","setTypeCustomStartEnd","toggleCalendar","changeTab","handleVisibleChange","componentDidMount","document","addEventListener","componentWillUnmount","removeEventListener","event","key","updatedState","combinedValue","join","setState","closeCalendar","prevState","e","target","startEndSectionRef","contains","getAttribute","popoverContainer","val","date","nextState","visible","renderPopover","grainOptions","timeFrames","timeFrame","timeRange","display","replace","toLowerCase","ref","render"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { FormControl, FormGroup, InputGroup, Radio } from 'react-bootstrap';\nimport { Tooltip } from 'src/common/components/Tooltip';\nimport Popover from 'src/common/components/Popover';\nimport { Select, Input } from 'src/common/components';\nimport Button from 'src/components/Button';\nimport Datetime from 'react-datetime';\nimport 'react-datetime/css/react-datetime.css';\nimport moment from 'moment';\nimport { t, styled, withTheme } from '@superset-ui/core';\n\nimport Tabs from 'src/common/components/Tabs';\nimport {\n  buildTimeRangeString,\n  formatTimeRange,\n} from 'src/explore/dateFilterUtils';\nimport Label from 'src/components/Label';\nimport './DateFilterControl.less';\nimport ControlHeader from '../ControlHeader';\nimport PopoverSection from '../../../components/PopoverSection';\n\nconst TYPES = Object.freeze({\n  DEFAULTS: 'defaults',\n  CUSTOM_START_END: 'custom_start_end',\n  CUSTOM_RANGE: 'custom_range',\n});\nconst TABS = Object.freeze({\n  DEFAULTS: 'defaults',\n  CUSTOM: 'custom',\n});\nconst RELATIVE_TIME_OPTIONS = Object.freeze({\n  LAST: 'Last',\n  NEXT: 'Next',\n});\nconst COMMON_TIME_FRAMES = [\n  'Last day',\n  'Last week',\n  'Last month',\n  'Last quarter',\n  'Last year',\n  'No filter',\n];\nconst TIME_GRAIN_OPTIONS = [\n  'seconds',\n  'minutes',\n  'hours',\n  'days',\n  'weeks',\n  'months',\n  'years',\n];\n\nconst MOMENT_FORMAT = 'YYYY-MM-DD[T]HH:mm:ss';\nconst DEFAULT_SINCE = moment()\n  .utc()\n  .startOf('day')\n  .subtract(7, 'days')\n  .format(MOMENT_FORMAT);\nconst DEFAULT_UNTIL = moment().utc().startOf('day').format(MOMENT_FORMAT);\nconst SEPARATOR = ' : ';\nconst FREEFORM_TOOLTIP = t(\n  'Superset supports smart date parsing. Strings like `3 weeks ago`, `last sunday`, or ' +\n    '`2 weeks from now` can be used.',\n);\n\nconst propTypes = {\n  animation: PropTypes.bool,\n  name: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  height: PropTypes.number,\n  onOpenDateFilterControl: PropTypes.func,\n  onCloseDateFilterControl: PropTypes.func,\n  endpoints: PropTypes.arrayOf(PropTypes.string),\n};\n\nconst defaultProps = {\n  animation: true,\n  onChange: () => {},\n  value: 'Last week',\n  onOpenDateFilterControl: () => {},\n  onCloseDateFilterControl: () => {},\n};\n\nfunction isValidMoment(s) {\n  /* Moment sometimes consider invalid dates as valid, eg, \"10 years ago\" gets\n   * parsed as \"Fri Jan 01 2010 00:00:00\" local time. This function does a\n   * better check by comparing a string with a parse/format roundtrip.\n   */\n  return s === moment(s, MOMENT_FORMAT).format(MOMENT_FORMAT);\n}\n\nfunction getStateFromSeparator(value) {\n  const [since, until] = value.split(SEPARATOR, 2);\n  return { since, until, type: TYPES.CUSTOM_START_END, tab: TABS.CUSTOM };\n}\n\nfunction getStateFromCommonTimeFrame(value) {\n  const units = `${value.split(' ')[1]}s`;\n  let sinceMoment;\n\n  if (value === 'No filter') {\n    sinceMoment = '';\n  } else if (units === 'years') {\n    sinceMoment = moment().utc().startOf(units).subtract(1, units);\n  } else {\n    sinceMoment = moment().utc().startOf('day').subtract(1, units);\n  }\n\n  return {\n    tab: TABS.DEFAULTS,\n    type: TYPES.DEFAULTS,\n    common: value,\n    since: sinceMoment === '' ? '' : sinceMoment.format(MOMENT_FORMAT),\n    until:\n      sinceMoment === '' ? '' : sinceMoment.add(1, units).format(MOMENT_FORMAT),\n  };\n}\n\nfunction getStateFromCustomRange(value) {\n  const [rel, num, grain] = value.split(' ', 3);\n  let since;\n  let until;\n  if (rel === RELATIVE_TIME_OPTIONS.LAST) {\n    until = moment().utc().startOf('day').format(MOMENT_FORMAT);\n    since = moment()\n      .utc()\n      .startOf('day')\n      .subtract(num, grain)\n      .format(MOMENT_FORMAT);\n  } else {\n    until = moment().utc().startOf('day').add(num, grain).format(MOMENT_FORMAT);\n    since = moment().startOf('day').format(MOMENT_FORMAT);\n  }\n  return {\n    tab: TABS.CUSTOM,\n    type: TYPES.CUSTOM_RANGE,\n    common: null,\n    rel,\n    num,\n    grain,\n    since,\n    until,\n  };\n}\n\nconst TimeFramesStyles = styled.div`\n  .radio {\n    margin: ${({ theme }) => theme.gridUnit}px 0;\n  }\n`;\n\nconst PopoverContentStyles = styled.div`\n  width: ${({ theme }) => theme.gridUnit * 60}px;\n\n  .timeframes-container {\n    margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n\n  .relative-timerange-container {\n    display: flex;\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n\n  .timerange-input {\n    width: ${({ theme }) => theme.gridUnit * 15}px;\n    margin: 0 ${({ theme }) => theme.gridUnit}px;\n  }\n\n  .datetime {\n    margin: ${({ theme }) => theme.gridUnit}px 0;\n  }\n\n  .ant-tabs {\n    overflow: visible;\n    & > .ant-tabs-content-holder {\n      overflow: visible;\n    }\n  }\n`;\n\nclass DateFilterControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      type: TYPES.DEFAULTS,\n      tab: TABS.DEFAULTS,\n\n      // default time frames, for convenience\n      common: COMMON_TIME_FRAMES[0],\n\n      // \"last 7 days\", \"next 4 weeks\", etc.\n      rel: RELATIVE_TIME_OPTIONS.LAST,\n      num: '7',\n      grain: TIME_GRAIN_OPTIONS[3],\n\n      // distinct start/end values, either ISO or freeform\n      since: DEFAULT_SINCE,\n      until: DEFAULT_UNTIL,\n\n      // react-datetime has a `closeOnSelect` prop, but it's buggy... so we\n      // handle the calendar visibility here ourselves\n      showSinceCalendar: false,\n      showUntilCalendar: false,\n      sinceViewMode: 'days',\n      untilViewMode: 'days',\n\n      popoverVisible: false,\n    };\n\n    const { value } = props;\n    if (value && value.indexOf(SEPARATOR) >= 0) {\n      this.state = { ...this.state, ...getStateFromSeparator(value) };\n    } else if (COMMON_TIME_FRAMES.indexOf(value) >= 0) {\n      this.state = { ...this.state, ...getStateFromCommonTimeFrame(value) };\n    } else if (value) {\n      this.state = { ...this.state, ...getStateFromCustomRange(value) };\n    }\n\n    this.close = this.close.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n    this.isValidSince = this.isValidSince.bind(this);\n    this.isValidUntil = this.isValidUntil.bind(this);\n    this.onEnter = this.onEnter.bind(this);\n    this.renderInput = this.renderInput.bind(this);\n    this.setCustomRange = this.setCustomRange.bind(this);\n    this.setCustomStartEnd = this.setCustomStartEnd.bind(this);\n    this.setTypeCustomRange = this.setTypeCustomRange.bind(this);\n    this.setTypeCustomStartEnd = this.setTypeCustomStartEnd.bind(this);\n    this.toggleCalendar = this.toggleCalendar.bind(this);\n    this.changeTab = this.changeTab.bind(this);\n    this.handleVisibleChange = this.handleVisibleChange.bind(this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('click', this.handleClick);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('click', this.handleClick);\n  }\n\n  onEnter(event) {\n    if (event.key === 'Enter') {\n      this.close();\n    }\n  }\n\n  setCustomRange(key, value) {\n    const updatedState = { ...this.state, [key]: value };\n    const combinedValue = [\n      updatedState.rel,\n      updatedState.num,\n      updatedState.grain,\n    ].join(' ');\n    this.setState(getStateFromCustomRange(combinedValue));\n  }\n\n  setCustomStartEnd(key, value) {\n    const closeCalendar =\n      (key === 'since' && this.state.sinceViewMode === 'days') ||\n      (key === 'until' && this.state.untilViewMode === 'days');\n    this.setState(prevState => ({\n      type: TYPES.CUSTOM_START_END,\n      [key]: typeof value === 'string' ? value : value.format(MOMENT_FORMAT),\n      showSinceCalendar: prevState.showSinceCalendar && !closeCalendar,\n      showUntilCalendar: prevState.showUntilCalendar && !closeCalendar,\n      sinceViewMode: closeCalendar ? 'days' : prevState.sinceViewMode,\n      untilViewMode: closeCalendar ? 'days' : prevState.untilViewMode,\n    }));\n  }\n\n  setTypeCustomRange() {\n    this.setState({ type: TYPES.CUSTOM_RANGE });\n  }\n\n  setTypeCustomStartEnd() {\n    this.setState({ type: TYPES.CUSTOM_START_END });\n  }\n\n  changeTab() {\n    const { tab } = this.state;\n    if (tab === TABS.CUSTOM) {\n      this.setState({ tab: TABS.DEFAULTS });\n    } else if (tab === TABS.DEFAULTS) {\n      this.setState({ tab: TABS.CUSTOM });\n    }\n  }\n\n  handleClick(e) {\n    const { target } = e;\n    // switch to `TYPES.CUSTOM_START_END` when the calendar is clicked\n    if (this.startEndSectionRef && this.startEndSectionRef.contains(target)) {\n      this.setTypeCustomStartEnd();\n    }\n\n    // if user click outside popover, popover will hide and we will call onCloseDateFilterControl,\n    // but need to exclude OverlayTrigger component to avoid handle click events twice.\n    if (target.getAttribute('name') !== 'popover-trigger') {\n      if (this.popoverContainer && !this.popoverContainer.contains(target)) {\n        this.props.onCloseDateFilterControl();\n      }\n    }\n  }\n\n  close() {\n    let val;\n    if (\n      this.state.type === TYPES.DEFAULTS ||\n      this.state.tab === TABS.DEFAULTS\n    ) {\n      val = this.state.common;\n    } else if (this.state.type === TYPES.CUSTOM_RANGE) {\n      val = `${this.state.rel} ${this.state.num} ${this.state.grain}`;\n    } else {\n      val = [this.state.since, this.state.until].join(SEPARATOR);\n    }\n    this.props.onCloseDateFilterControl();\n    this.props.onChange(val);\n    this.setState({\n      showSinceCalendar: false,\n      showUntilCalendar: false,\n      popoverVisible: false,\n    });\n  }\n\n  isValidSince(date) {\n    return (\n      !isValidMoment(this.state.until) ||\n      date <= moment(this.state.until, MOMENT_FORMAT)\n    );\n  }\n\n  isValidUntil(date) {\n    return (\n      !isValidMoment(this.state.since) ||\n      date >= moment(this.state.since, MOMENT_FORMAT)\n    );\n  }\n\n  toggleCalendar(key) {\n    const nextState = {};\n    if (key === 'showSinceCalendar') {\n      nextState.showSinceCalendar = !this.state.showSinceCalendar;\n      if (!this.state.showSinceCalendar) {\n        nextState.showUntilCalendar = false;\n      }\n    } else if (key === 'showUntilCalendar') {\n      nextState.showUntilCalendar = !this.state.showUntilCalendar;\n      if (!this.state.showUntilCalendar) {\n        nextState.showSinceCalendar = false;\n      }\n    }\n    this.setState(nextState);\n  }\n\n  handleVisibleChange(visible) {\n    if (visible) {\n      this.props.onOpenDateFilterControl();\n    } else {\n      this.props.onCloseDateFilterControl();\n    }\n    this.setState({ popoverVisible: visible });\n  }\n\n  renderInput(props, key) {\n    return (\n      <FormGroup>\n        <InputGroup bsSize=\"small\">\n          <FormControl\n            {...props}\n            type=\"text\"\n            onKeyPress={this.onEnter}\n            onFocus={this.setTypeCustomStartEnd}\n            onClick={() => {}}\n          />\n          <InputGroup.Button onClick={() => this.toggleCalendar(key)}>\n            <Button>\n              <i className=\"fa fa-calendar\" />\n            </Button>\n          </InputGroup.Button>\n        </InputGroup>\n      </FormGroup>\n    );\n  }\n\n  renderPopover() {\n    const grainOptions = TIME_GRAIN_OPTIONS.map(grain => (\n      <Select.Option\n        key={grain}\n        value={grain}\n        active={grain === this.state.grain}\n      >\n        {grain}\n      </Select.Option>\n    ));\n    const timeFrames = COMMON_TIME_FRAMES.map(timeFrame => {\n      const nextState = getStateFromCommonTimeFrame(timeFrame);\n      const timeRange = buildTimeRangeString(nextState.since, nextState.until);\n\n      return (\n        <TimeFramesStyles key={timeFrame}>\n          <Tooltip\n            id={`tooltip-${timeFrame}`}\n            key={timeFrame}\n            placement=\"right\"\n            title={formatTimeRange(timeRange, this.props.endpoints)}\n          >\n            <div style={{ display: 'inline-block' }}>\n              <Radio\n                key={timeFrame.replace(' ', '').toLowerCase()}\n                checked={this.state.common === timeFrame}\n                onChange={() => this.setState(nextState)}\n              >\n                {timeFrame}\n              </Radio>\n            </div>\n          </Tooltip>\n        </TimeFramesStyles>\n      );\n    });\n\n    return (\n      <PopoverContentStyles\n        id=\"filter-popover\"\n        ref={ref => {\n          this.popoverContainer = ref;\n        }}\n      >\n        <Tabs\n          defaultActiveKey={this.state.tab === TABS.DEFAULTS ? '1' : '2'}\n          id=\"type\"\n          className=\"time-filter-tabs\"\n          onChange={this.changeTab}\n        >\n          <Tabs.TabPane key=\"1\" tab=\"Defaults\" forceRender>\n            <div className=\"timeframes-container\">\n              <FormGroup>{timeFrames}</FormGroup>\n            </div>\n          </Tabs.TabPane>\n          <Tabs.TabPane key=\"2\" tab=\"Custom\">\n            <FormGroup>\n              <PopoverSection\n                title=\"Relative to today\"\n                isSelected={this.state.type === TYPES.CUSTOM_RANGE}\n                onSelect={this.setTypeCustomRange}\n              >\n                <div className=\"relative-timerange-container clearfix centered\">\n                  <Select\n                    value={this.state.rel}\n                    onSelect={value => this.setCustomRange('rel', value)}\n                    onFocus={this.setTypeCustomRange}\n                  >\n                    <Select.Option value={RELATIVE_TIME_OPTIONS.LAST}>\n                      Last\n                    </Select.Option>\n                    <Select.Option value={RELATIVE_TIME_OPTIONS.NEXT}>\n                      Next\n                    </Select.Option>\n                  </Select>\n                  <Input\n                    className=\"timerange-input\"\n                    type=\"text\"\n                    onChange={event =>\n                      this.setCustomRange('num', event.target.value)\n                    }\n                    onFocus={this.setTypeCustomRange}\n                    onPressEnter={this.close}\n                    value={this.state.num}\n                  />\n                  <Select\n                    value={this.state.grain}\n                    onFocus={this.setTypeCustomRange}\n                    onSelect={value => this.setCustomRange('grain', value)}\n                    dropdownMatchSelectWidth={false}\n                  >\n                    {grainOptions}\n                  </Select>\n                </div>\n              </PopoverSection>\n              <PopoverSection\n                title=\"Start / end\"\n                isSelected={this.state.type === TYPES.CUSTOM_START_END}\n                onSelect={this.setTypeCustomStartEnd}\n                info={FREEFORM_TOOLTIP}\n              >\n                <div\n                  ref={ref => {\n                    this.startEndSectionRef = ref;\n                  }}\n                >\n                  <InputGroup data-test=\"date-input-group\">\n                    <Datetime\n                      className=\"datetime\"\n                      inputProps={{ 'data-test': 'date-from-input' }}\n                      value={this.state.since}\n                      defaultValue={this.state.since}\n                      viewDate={this.state.since}\n                      onChange={value => this.setCustomStartEnd('since', value)}\n                      isValidDate={this.isValidSince}\n                      onClick={this.setTypeCustomStartEnd}\n                      renderInput={props =>\n                        this.renderInput(props, 'showSinceCalendar')\n                      }\n                      open={this.state.showSinceCalendar}\n                      viewMode={this.state.sinceViewMode}\n                      onViewModeChange={sinceViewMode =>\n                        this.setState({ sinceViewMode })\n                      }\n                    />\n                    <Datetime\n                      className=\"datetime\"\n                      inputProps={{ 'data-test': 'date-to-input' }}\n                      value={this.state.until}\n                      defaultValue={this.state.until}\n                      viewDate={this.state.until}\n                      onChange={value => this.setCustomStartEnd('until', value)}\n                      isValidDate={this.isValidUntil}\n                      onClick={this.setTypeCustomStartEnd}\n                      renderInput={props =>\n                        this.renderInput(props, 'showUntilCalendar')\n                      }\n                      open={this.state.showUntilCalendar}\n                      viewMode={this.state.untilViewMode}\n                      onViewModeChange={untilViewMode =>\n                        this.setState({ untilViewMode })\n                      }\n                    />\n                  </InputGroup>\n                </div>\n              </PopoverSection>\n            </FormGroup>\n          </Tabs.TabPane>\n        </Tabs>\n        <div className=\"clearfix\">\n          <Button\n            data-test=\"date-ok-button\"\n            buttonSize=\"small\"\n            className=\"float-right ok\"\n            buttonStyle=\"primary\"\n            onClick={this.close}\n          >\n            Ok\n          </Button>\n        </div>\n      </PopoverContentStyles>\n    );\n  }\n\n  render() {\n    const timeRange = this.props.value || defaultProps.value;\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Popover\n          trigger=\"click\"\n          placement=\"right\"\n          content={this.renderPopover()}\n          visible={this.state.popoverVisible}\n          onVisibleChange={this.handleVisibleChange}\n        >\n          <Label\n            name=\"popover-trigger\"\n            className=\"pointer\"\n            data-test=\"popover-trigger\"\n          >\n            {formatTimeRange(timeRange, this.props.endpoints)}\n          </Label>\n        </Popover>\n      </div>\n    );\n  }\n}\n\nexport default withTheme(DateFilterControl);\n\nDateFilterControl.propTypes = propTypes;\nDateFilterControl.defaultProps = defaultProps;\n"]},"metadata":{},"sourceType":"module"}