{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _Array$isArray from \"@babel/runtime-corejs3/core-js-stable/array/is-array\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { styled, SuperChart, t } from '@superset-ui/core';\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { useSelector } from 'react-redux';\nimport cx from 'classnames';\nimport { Form } from 'src/common/components';\nimport Button from 'src/components/Button';\nimport Icon from 'src/components/Icon';\nimport { getChartDataRequest } from 'src/chart/chartAction';\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport Loading from 'src/components/Loading';\nimport FilterConfigurationLink from './FilterConfigurationLink';\n// import FilterScopeModal from 'src/dashboard/components/filterscope/FilterScopeModal';\nimport { useCascadingFilters, useFilterConfiguration, useSetExtraFormData } from './state';\nimport { buildCascadeFiltersTree, mapParentFiltersToChildren } from './utils';\nimport CascadePopover from './CascadePopover';import { jsx as ___EmotionJSX } from \"@emotion/core\";\nconst barWidth = `250px`;\nconst BarWrapper = styled.div`\n  width: ${({ theme }) => theme.gridUnit * 8}px;\n  &.open {\n    width: ${barWidth}; // arbitrary...\n  }\n`;\nconst Bar = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  flex-direction: column;\n  flex-grow: 1;\n  width: ${barWidth}; // arbitrary...\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  min-height: 100%;\n  display: none;\n  /* &.animated {\n    display: flex;\n    transform: translateX(-100%);\n    transition: transform ${({ theme }) => theme.transitionTiming}s;\n    transition-delay: 0s;\n  }  */\n  &.open {\n    display: flex;\n    /* &.animated {\n      transform: translateX(0);\n      transition-delay: ${({ theme }) => theme.transitionTiming * 2}s;\n    } */\n  }\n`;\nconst CollapsedBar = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: ${({ theme }) => theme.gridUnit * 8}px;\n  padding-top: ${({ theme }) => theme.gridUnit * 2}px;\n  display: none;\n  text-align: center;\n  /* &.animated {\n    display: block;\n    transform: translateX(-100%);\n    transition: transform ${({ theme }) => theme.transitionTiming}s;\n    transition-delay: 0s;\n  } */\n  &.open {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: ${({ theme }) => theme.gridUnit * 2}px;\n    /* &.animated {\n      transform: translateX(0);\n      transition-delay: ${({ theme }) => theme.transitionTiming * 3}s;\n    } */\n  }\n  svg {\n    width: ${({ theme }) => theme.gridUnit * 4}px;\n    height: ${({ theme }) => theme.gridUnit * 4}px;\n    cursor: pointer;\n  }\n`;\nconst StyledCollapseIcon = styled(Icon)`\n  color: ${({ theme }) => theme.colors.primary.base};\n  margin-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n`;\nconst TitleArea = styled.h4`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  margin: 0;\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n  & > span {\n    flex-grow: 1;\n  }\n  & :not(:first-child) {\n    margin-left: ${({ theme }) => theme.gridUnit}px;\n    &:hover {\n      cursor: pointer;\n    }\n  }\n`;\nconst ActionButtons = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-around;\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n  padding-top: 0;\n  border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .btn {\n    flex: 1 1 50%;\n  }\n`;\nconst FilterControls = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n`;\nconst StyledCascadeChildrenList = styled.ul`\n  list-style-type: none;\n  & > * {\n    list-style-type: none;\n  }\n`;\nconst StyledFilterControlTitle = styled.h4`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.dark1};\n  margin: 0;\n  text-transform: uppercase;\n`;\nconst StyledFilterControlTitleBox = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: ${({ theme }) => theme.gridUnit}px;\n`;\nconst StyledFilterControlContainer = styled.div`\n  width: 100%;\n`;\nconst StyledFilterControlBox = styled.div`\n  display: flex;\n`;\nconst StyledCaretIcon = styled(Icon)`\n  margin-top: ${({ theme }) => -theme.gridUnit}px;\n`;\nconst StyledLoadingBox = styled.div`\n  position: relative;\n  height: ${({ theme }) => theme.gridUnit * 8}px;\n  margin-bottom: ${({ theme }) => theme.gridUnit * 6}px;\n`;\nconst FilterValue = ({ filter, onExtraFormDataChange }) => {\n  const { id, allowsMultipleValues, inverseSelection, targets, currentValue, defaultValue } = filter;\n  const cascadingFilters = useCascadingFilters(id);\n  const [loading, setLoading] = useState(true);\n  const [state, setState] = useState([]);\n  const [formData, setFormData] = useState({});\n  const [target] = targets;\n  const { datasetId = 18, column } = target;\n  const { name: groupby } = column;\n  const getFormData = () => ({\n    adhoc_filters: [],\n    datasource: `${datasetId}__table`,\n    extra_filters: [],\n    extra_form_data: cascadingFilters,\n    granularity_sqla: 'ds',\n    groupby: [groupby],\n    inverseSelection,\n    metrics: ['count'],\n    multiSelect: allowsMultipleValues,\n    row_limit: 10000,\n    showSearch: true,\n    time_range: 'No filter',\n    time_range_endpoints: ['inclusive', 'exclusive'],\n    url_params: {},\n    viz_type: 'filter_select',\n    defaultValues: currentValue || defaultValue || [] });\n\n  useEffect(() => {\n    const newFormData = getFormData();\n    if (!areObjectsEqual(formData || {}, newFormData)) {\n      setFormData(newFormData);\n      getChartDataRequest({\n        formData: newFormData,\n        force: false,\n        requestParams: { dashboardId: 0 } }).\n      then(response => {\n        setState(response.result);\n        setLoading(false);\n      });\n    }\n  }, [cascadingFilters]);\n  const setExtraFormData = extraFormData => onExtraFormDataChange(filter, extraFormData);\n  if (loading) {\n    return ___EmotionJSX(StyledLoadingBox, null,\n    ___EmotionJSX(Loading, null));\n\n  }\n  return ___EmotionJSX(Form, { onFinish: values => {\n      setExtraFormData(values.value);\n    } },\n  ___EmotionJSX(Form.Item, { name: \"value\" },\n  ___EmotionJSX(SuperChart, { height: 20, width: 220, formData: getFormData(), queriesData: state, chartType: \"filter_select\", hooks: { setExtraFormData } })));\n\n\n};__signature__(FilterValue, \"useCascadingFilters{cascadingFilters}\\nuseState{[loading, setLoading](true)}\\nuseState{[state, setState]([])}\\nuseState{[formData, setFormData]({})}\\nuseEffect{}\", () => [useCascadingFilters]);\nexport const FilterControl = ({ filter, icon, onExtraFormDataChange }) => {\n  const { name = '<undefined>' } = filter;\n  return ___EmotionJSX(StyledFilterControlContainer, null,\n  ___EmotionJSX(StyledFilterControlTitleBox, null,\n  ___EmotionJSX(StyledFilterControlTitle, null, name),\n  ___EmotionJSX(\"div\", null, icon)),\n\n  ___EmotionJSX(FilterValue, { filter: filter, onExtraFormDataChange: onExtraFormDataChange }));\n\n};\nexport const CascadeFilterControl = ({ filter, onExtraFormDataChange }) => {var _filter$cascadeChildr;return ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(StyledFilterControlBox, null,\n  ___EmotionJSX(StyledCaretIcon, { name: \"caret-down\" }),\n  ___EmotionJSX(FilterControl, { filter: filter, onExtraFormDataChange: onExtraFormDataChange })),\n\n\n  ___EmotionJSX(StyledCascadeChildrenList, null, (_filter$cascadeChildr =\n  filter.cascadeChildren) == null ? void 0 : _mapInstanceProperty(_filter$cascadeChildr).call(_filter$cascadeChildr, childFilter => ___EmotionJSX(\"li\", { key: childFilter.id },\n  ___EmotionJSX(CascadeFilterControl, { filter: childFilter, onExtraFormDataChange: onExtraFormDataChange })))));};\n\n\n\nconst FilterBar = ({ filtersOpen, toggleFiltersBar }) => {\n  const [filterData, setFilterData] = useState({});\n  const setExtraFormData = useSetExtraFormData();\n  const filterConfigs = useFilterConfiguration();\n  const canEdit = useSelector(({ dashboardInfo }) => dashboardInfo.dash_edit_perm);\n  const [visiblePopoverId, setVisiblePopoverId] = useState(null);\n  useEffect(() => {\n    if (filterConfigs.length === 0 && filtersOpen) {\n      toggleFiltersBar(false);\n    }\n  }, [filterConfigs]);\n  const getFilterValue = useCallback(filter => {var _filterData$filter$id, _filterData$filter$id2;\n    const filters = (_filterData$filter$id = filterData[filter.id]) == null ? void 0 : (_filterData$filter$id2 = _filterData$filter$id.append_form_data) == null ? void 0 : _filterData$filter$id2.filters;\n    if (filters != null && filters.length) {\n      const filter = filters[0];\n      if ('val' in filter) {\n        // need to nest these if statements to get a reference to val to appease TS\n        const { val } = filter;\n        if (_Array$isArray(val)) {\n          return val;\n        }\n        return [val];\n      }\n    }\n    return null;\n  }, [filterData]);\n  const cascadeChildren = useMemo(() => mapParentFiltersToChildren(filterConfigs), [filterConfigs]);\n  const cascadeFilters = useMemo(() => {\n    const filtersWithValue = _mapInstanceProperty(filterConfigs).call(filterConfigs, filter => ({\n      ...filter,\n      currentValue: getFilterValue(filter) }));\n\n    return buildCascadeFiltersTree(filtersWithValue);\n  }, [filterConfigs, getFilterValue]);\n  const handleExtraFormDataChange = (filter, extraFormData) => {\n    setFilterData(prevFilterData => ({\n      ...prevFilterData,\n      [filter.id]: extraFormData }));\n\n    const children = cascadeChildren[filter.id] || [];\n    // force instant updating for parent filters\n    if (filter.isInstant || children.length > 0) {\n      setExtraFormData(filter.id, extraFormData);\n    }\n  };\n  const handleApply = () => {\n    const filterIds = _Object$keys(filterData);\n    _forEachInstanceProperty(filterIds).call(filterIds, filterId => {\n      if (filterData[filterId]) {\n        setExtraFormData(filterId, filterData[filterId]);\n      }\n    });\n  };\n  const handleResetAll = () => {\n    setFilterData({});\n    const filterIds = _Object$keys(filterData);\n    _forEachInstanceProperty(filterIds).call(filterIds, filterId => {\n      if (filterData[filterId]) {\n        setExtraFormData(filterId, {});\n      }\n    });\n  };\n  return ___EmotionJSX(BarWrapper, { \"data-test\": \"filter-bar\", className: cx({ open: filtersOpen }) },\n  ___EmotionJSX(CollapsedBar, { className: cx({ open: !filtersOpen }), onClick: () => toggleFiltersBar(true) },\n  ___EmotionJSX(StyledCollapseIcon, { name: \"collapse\" }),\n  ___EmotionJSX(Icon, { name: \"filter\" })),\n\n  ___EmotionJSX(Bar, { className: cx({ open: filtersOpen }) },\n  ___EmotionJSX(TitleArea, null,\n  ___EmotionJSX(\"span\", null,\n  t('Filters'), \" (\", filterConfigs.length, \")\"),\n\n  canEdit && ___EmotionJSX(FilterConfigurationLink, { createNewOnOpen: filterConfigs.length === 0 },\n  ___EmotionJSX(Icon, { name: \"edit\", \"data-test\": \"create-filter\" })),\n\n  ___EmotionJSX(Icon, { name: \"expand\", onClick: () => toggleFiltersBar(false) })),\n\n  ___EmotionJSX(ActionButtons, null,\n  ___EmotionJSX(Button, { buttonStyle: \"secondary\", buttonSize: \"sm\", onClick: handleResetAll },\n  t('Reset all')),\n\n  ___EmotionJSX(Button, { buttonStyle: \"primary\", type: \"submit\", buttonSize: \"sm\", onClick: handleApply },\n  t('Apply'))),\n\n\n  ___EmotionJSX(FilterControls, null,\n  _mapInstanceProperty(cascadeFilters).call(cascadeFilters, filter => ___EmotionJSX(CascadePopover, { \"data-test\": \"cascade-filters-control\", key: filter.id, visible: visiblePopoverId === filter.id, onVisibleChange: visible => setVisiblePopoverId(visible ? filter.id : null), filter: filter, onExtraFormDataChange: handleExtraFormDataChange })))));\n\n\n\n};__signature__(FilterBar, \"useState{[filterData, setFilterData]({})}\\nuseSetExtraFormData{setExtraFormData}\\nuseFilterConfiguration{filterConfigs}\\nuseSelector{canEdit}\\nuseState{[visiblePopoverId, setVisiblePopoverId](null)}\\nuseEffect{}\\nuseCallback{getFilterValue}\\nuseMemo{cascadeChildren}\\nuseMemo{cascadeFilters}\", () => [useSetExtraFormData, useFilterConfiguration, useSelector]);const _default =\nFilterBar;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(barWidth, \"barWidth\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(BarWrapper, \"BarWrapper\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(Bar, \"Bar\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(CollapsedBar, \"CollapsedBar\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(StyledCollapseIcon, \"StyledCollapseIcon\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(TitleArea, \"TitleArea\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(ActionButtons, \"ActionButtons\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(FilterControls, \"FilterControls\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(StyledCascadeChildrenList, \"StyledCascadeChildrenList\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(StyledFilterControlTitle, \"StyledFilterControlTitle\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(StyledFilterControlTitleBox, \"StyledFilterControlTitleBox\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(StyledFilterControlContainer, \"StyledFilterControlContainer\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(StyledFilterControlBox, \"StyledFilterControlBox\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(StyledCaretIcon, \"StyledCaretIcon\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(StyledLoadingBox, \"StyledLoadingBox\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(FilterValue, \"FilterValue\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(FilterControl, \"FilterControl\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(CascadeFilterControl, \"CascadeFilterControl\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(FilterBar, \"FilterBar\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  QueryFormData,\n  styled,\n  SuperChart,\n  t,\n  ExtraFormData,\n} from '@superset-ui/core';\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { useSelector } from 'react-redux';\nimport cx from 'classnames';\nimport { Form } from 'src/common/components';\nimport Button from 'src/components/Button';\nimport Icon from 'src/components/Icon';\nimport { getChartDataRequest } from 'src/chart/chartAction';\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport Loading from 'src/components/Loading';\nimport FilterConfigurationLink from './FilterConfigurationLink';\n// import FilterScopeModal from 'src/dashboard/components/filterscope/FilterScopeModal';\n\nimport {\n  useCascadingFilters,\n  useFilterConfiguration,\n  useSetExtraFormData,\n} from './state';\nimport { Filter, CascadeFilter } from './types';\nimport { buildCascadeFiltersTree, mapParentFiltersToChildren } from './utils';\nimport CascadePopover from './CascadePopover';\n\nconst barWidth = `250px`;\n\nconst BarWrapper = styled.div`\n  width: ${({ theme }) => theme.gridUnit * 8}px;\n  &.open {\n    width: ${barWidth}; // arbitrary...\n  }\n`;\n\nconst Bar = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  flex-direction: column;\n  flex-grow: 1;\n  width: ${barWidth}; // arbitrary...\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  min-height: 100%;\n  display: none;\n  /* &.animated {\n    display: flex;\n    transform: translateX(-100%);\n    transition: transform ${({ theme }) => theme.transitionTiming}s;\n    transition-delay: 0s;\n  }  */\n  &.open {\n    display: flex;\n    /* &.animated {\n      transform: translateX(0);\n      transition-delay: ${({ theme }) => theme.transitionTiming * 2}s;\n    } */\n  }\n`;\n\nconst CollapsedBar = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: ${({ theme }) => theme.gridUnit * 8}px;\n  padding-top: ${({ theme }) => theme.gridUnit * 2}px;\n  display: none;\n  text-align: center;\n  /* &.animated {\n    display: block;\n    transform: translateX(-100%);\n    transition: transform ${({ theme }) => theme.transitionTiming}s;\n    transition-delay: 0s;\n  } */\n  &.open {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: ${({ theme }) => theme.gridUnit * 2}px;\n    /* &.animated {\n      transform: translateX(0);\n      transition-delay: ${({ theme }) => theme.transitionTiming * 3}s;\n    } */\n  }\n  svg {\n    width: ${({ theme }) => theme.gridUnit * 4}px;\n    height: ${({ theme }) => theme.gridUnit * 4}px;\n    cursor: pointer;\n  }\n`;\n\nconst StyledCollapseIcon = styled(Icon)`\n  color: ${({ theme }) => theme.colors.primary.base};\n  margin-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n`;\n\nconst TitleArea = styled.h4`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  margin: 0;\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n  & > span {\n    flex-grow: 1;\n  }\n  & :not(:first-child) {\n    margin-left: ${({ theme }) => theme.gridUnit}px;\n    &:hover {\n      cursor: pointer;\n    }\n  }\n`;\n\nconst ActionButtons = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-around;\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n  padding-top: 0;\n  border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .btn {\n    flex: 1 1 50%;\n  }\n`;\n\nconst FilterControls = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\nconst StyledCascadeChildrenList = styled.ul`\n  list-style-type: none;\n  & > * {\n    list-style-type: none;\n  }\n`;\n\nconst StyledFilterControlTitle = styled.h4`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.dark1};\n  margin: 0;\n  text-transform: uppercase;\n`;\n\nconst StyledFilterControlTitleBox = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: ${({ theme }) => theme.gridUnit}px;\n`;\n\nconst StyledFilterControlContainer = styled.div`\n  width: 100%;\n`;\n\nconst StyledFilterControlBox = styled.div`\n  display: flex;\n`;\n\nconst StyledCaretIcon = styled(Icon)`\n  margin-top: ${({ theme }) => -theme.gridUnit}px;\n`;\n\nconst StyledLoadingBox = styled.div`\n  position: relative;\n  height: ${({ theme }) => theme.gridUnit * 8}px;\n  margin-bottom: ${({ theme }) => theme.gridUnit * 6}px;\n`;\n\ninterface FilterProps {\n  filter: Filter;\n  icon?: React.ReactElement;\n  onExtraFormDataChange: (filter: Filter, extraFormData: ExtraFormData) => void;\n}\n\ninterface FiltersBarProps {\n  filtersOpen: boolean;\n  toggleFiltersBar: any;\n}\n\nconst FilterValue: React.FC<FilterProps> = ({\n  filter,\n  onExtraFormDataChange,\n}) => {\n  const {\n    id,\n    allowsMultipleValues,\n    inverseSelection,\n    targets,\n    currentValue,\n    defaultValue,\n  } = filter;\n  const cascadingFilters = useCascadingFilters(id);\n  const [loading, setLoading] = useState<boolean>(true);\n  const [state, setState] = useState([]);\n  const [formData, setFormData] = useState<Partial<QueryFormData>>({});\n  const [target] = targets;\n  const { datasetId = 18, column } = target;\n  const { name: groupby } = column;\n\n  const getFormData = (): Partial<QueryFormData> => ({\n    adhoc_filters: [],\n    datasource: `${datasetId}__table`,\n    extra_filters: [],\n    extra_form_data: cascadingFilters,\n    granularity_sqla: 'ds',\n    groupby: [groupby],\n    inverseSelection,\n    metrics: ['count'],\n    multiSelect: allowsMultipleValues,\n    row_limit: 10000,\n    showSearch: true,\n    time_range: 'No filter',\n    time_range_endpoints: ['inclusive', 'exclusive'],\n    url_params: {},\n    viz_type: 'filter_select',\n    defaultValues: currentValue || defaultValue || [],\n  });\n\n  useEffect(() => {\n    const newFormData = getFormData();\n    if (!areObjectsEqual(formData || {}, newFormData)) {\n      setFormData(newFormData);\n      getChartDataRequest({\n        formData: newFormData,\n        force: false,\n        requestParams: { dashboardId: 0 },\n      }).then(response => {\n        setState(response.result);\n        setLoading(false);\n      });\n    }\n  }, [cascadingFilters]);\n\n  const setExtraFormData = (extraFormData: ExtraFormData) =>\n    onExtraFormDataChange(filter, extraFormData);\n\n  if (loading) {\n    return (\n      <StyledLoadingBox>\n        <Loading />\n      </StyledLoadingBox>\n    );\n  }\n\n  return (\n    <Form\n      onFinish={values => {\n        setExtraFormData(values.value);\n      }}\n    >\n      <Form.Item name=\"value\">\n        <SuperChart\n          height={20}\n          width={220}\n          formData={getFormData()}\n          queriesData={state}\n          chartType=\"filter_select\"\n          hooks={{ setExtraFormData }}\n        />\n      </Form.Item>\n    </Form>\n  );\n};\n\nexport const FilterControl: React.FC<FilterProps> = ({\n  filter,\n  icon,\n  onExtraFormDataChange,\n}) => {\n  const { name = '<undefined>' } = filter;\n  return (\n    <StyledFilterControlContainer>\n      <StyledFilterControlTitleBox>\n        <StyledFilterControlTitle>{name}</StyledFilterControlTitle>\n        <div>{icon}</div>\n      </StyledFilterControlTitleBox>\n      <FilterValue\n        filter={filter}\n        onExtraFormDataChange={onExtraFormDataChange}\n      />\n    </StyledFilterControlContainer>\n  );\n};\n\ninterface CascadeFilterControlProps {\n  filter: CascadeFilter;\n  onExtraFormDataChange: (filter: Filter, extraFormData: ExtraFormData) => void;\n}\n\nexport const CascadeFilterControl: React.FC<CascadeFilterControlProps> = ({\n  filter,\n  onExtraFormDataChange,\n}) => (\n  <>\n    <StyledFilterControlBox>\n      <StyledCaretIcon name=\"caret-down\" />\n      <FilterControl\n        filter={filter}\n        onExtraFormDataChange={onExtraFormDataChange}\n      />\n    </StyledFilterControlBox>\n\n    <StyledCascadeChildrenList>\n      {filter.cascadeChildren?.map(childFilter => (\n        <li key={childFilter.id}>\n          <CascadeFilterControl\n            filter={childFilter}\n            onExtraFormDataChange={onExtraFormDataChange}\n          />\n        </li>\n      ))}\n    </StyledCascadeChildrenList>\n  </>\n);\n\nconst FilterBar: React.FC<FiltersBarProps> = ({\n  filtersOpen,\n  toggleFiltersBar,\n}) => {\n  const [filterData, setFilterData] = useState<{ [id: string]: ExtraFormData }>(\n    {},\n  );\n  const setExtraFormData = useSetExtraFormData();\n  const filterConfigs = useFilterConfiguration();\n  const canEdit = useSelector<any, boolean>(\n    ({ dashboardInfo }) => dashboardInfo.dash_edit_perm,\n  );\n  const [visiblePopoverId, setVisiblePopoverId] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (filterConfigs.length === 0 && filtersOpen) {\n      toggleFiltersBar(false);\n    }\n  }, [filterConfigs]);\n\n  const getFilterValue = useCallback(\n    (filter: Filter): (string | number | boolean)[] | null => {\n      const filters = filterData[filter.id]?.append_form_data?.filters;\n      if (filters?.length) {\n        const filter = filters[0];\n        if ('val' in filter) {\n          // need to nest these if statements to get a reference to val to appease TS\n          const { val } = filter;\n          if (Array.isArray(val)) {\n            return val;\n          }\n          return [val];\n        }\n      }\n      return null;\n    },\n    [filterData],\n  );\n\n  const cascadeChildren = useMemo(\n    () => mapParentFiltersToChildren(filterConfigs),\n    [filterConfigs],\n  );\n\n  const cascadeFilters = useMemo(() => {\n    const filtersWithValue = filterConfigs.map(filter => ({\n      ...filter,\n      currentValue: getFilterValue(filter),\n    }));\n    return buildCascadeFiltersTree(filtersWithValue);\n  }, [filterConfigs, getFilterValue]);\n\n  const handleExtraFormDataChange = (\n    filter: Filter,\n    extraFormData: ExtraFormData,\n  ) => {\n    setFilterData(prevFilterData => ({\n      ...prevFilterData,\n      [filter.id]: extraFormData,\n    }));\n\n    const children = cascadeChildren[filter.id] || [];\n    // force instant updating for parent filters\n    if (filter.isInstant || children.length > 0) {\n      setExtraFormData(filter.id, extraFormData);\n    }\n  };\n\n  const handleApply = () => {\n    const filterIds = Object.keys(filterData);\n    filterIds.forEach(filterId => {\n      if (filterData[filterId]) {\n        setExtraFormData(filterId, filterData[filterId]);\n      }\n    });\n  };\n\n  const handleResetAll = () => {\n    setFilterData({});\n    const filterIds = Object.keys(filterData);\n    filterIds.forEach(filterId => {\n      if (filterData[filterId]) {\n        setExtraFormData(filterId, {});\n      }\n    });\n  };\n\n  return (\n    <BarWrapper data-test=\"filter-bar\" className={cx({ open: filtersOpen })}>\n      <CollapsedBar\n        className={cx({ open: !filtersOpen })}\n        onClick={() => toggleFiltersBar(true)}\n      >\n        <StyledCollapseIcon name=\"collapse\" />\n        <Icon name=\"filter\" />\n      </CollapsedBar>\n      <Bar className={cx({ open: filtersOpen })}>\n        <TitleArea>\n          <span>\n            {t('Filters')} ({filterConfigs.length})\n          </span>\n          {canEdit && (\n            <FilterConfigurationLink\n              createNewOnOpen={filterConfigs.length === 0}\n            >\n              <Icon name=\"edit\" data-test=\"create-filter\" />\n            </FilterConfigurationLink>\n          )}\n          <Icon name=\"expand\" onClick={() => toggleFiltersBar(false)} />\n        </TitleArea>\n        <ActionButtons>\n          <Button\n            buttonStyle=\"secondary\"\n            buttonSize=\"sm\"\n            onClick={handleResetAll}\n          >\n            {t('Reset all')}\n          </Button>\n          <Button\n            buttonStyle=\"primary\"\n            type=\"submit\"\n            buttonSize=\"sm\"\n            onClick={handleApply}\n          >\n            {t('Apply')}\n          </Button>\n        </ActionButtons>\n        <FilterControls>\n          {cascadeFilters.map(filter => (\n            <CascadePopover\n              data-test=\"cascade-filters-control\"\n              key={filter.id}\n              visible={visiblePopoverId === filter.id}\n              onVisibleChange={visible =>\n                setVisiblePopoverId(visible ? filter.id : null)\n              }\n              filter={filter}\n              onExtraFormDataChange={handleExtraFormDataChange}\n            />\n          ))}\n        </FilterControls>\n      </Bar>\n    </BarWrapper>\n  );\n};\n\nexport default FilterBar;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}