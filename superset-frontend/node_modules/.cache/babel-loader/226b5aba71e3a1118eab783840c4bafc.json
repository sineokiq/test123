{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _trimInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/trim\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState, useRef } from 'react';\nimport cx from 'classnames';\nimport { t } from '@superset-ui/core';\nimport TooltipWrapper from './TooltipWrapper';import { jsx as ___EmotionJSX } from \"@emotion/core\";\nexport default function EditableTitle({ canEdit = false, emptyText, extraClasses, multiLine = false, noPermitTooltip, onSaveTitle, showTooltip = true, style, title }) {\n  const [isEditing, setIsEditing] = useState(false);\n  const [currentTitle, setCurrentTitle] = useState(title);\n  const [lastTitle, setLastTitle] = useState(title);\n  const [contentBoundingRect, setContentBoundingRect] = useState(null);\n  // Used so we can access the DOM element if a user clicks on this component.\n  const contentRef = useRef();\n  useEffect(() => {\n    if (title !== currentTitle) {\n      setLastTitle(currentTitle);\n      setCurrentTitle(title);\n    }\n  }, [title]);\n  function handleClick() {\n    if (!canEdit || isEditing) {\n      return;\n    }\n    // For multi-line values, save the actual rendered size of the displayed text.\n    // Later, if a textarea is constructed for editing the value, we'll need this.\n    const contentBounding = contentRef.current ?\n    contentRef.current.getBoundingClientRect() :\n    null;\n    setIsEditing(true);\n    setContentBoundingRect(contentBounding);\n  }\n  function handleBlur() {\n    const formattedTitle = _trimInstanceProperty(currentTitle).call(currentTitle);\n    if (!canEdit) {\n      return;\n    }\n    setIsEditing(false);\n    if (!formattedTitle.length) {\n      setCurrentTitle(lastTitle);\n      return;\n    }\n    if (lastTitle !== formattedTitle) {\n      setLastTitle(formattedTitle);\n    }\n    if (title !== formattedTitle) {\n      onSaveTitle(formattedTitle);\n    }\n  }\n  // this entire method exists to support using EditableTitle as the title of a\n  // react-bootstrap Tab, as a workaround for this line in react-bootstrap https://goo.gl/ZVLmv4\n  //\n  // tl;dr when a Tab EditableTitle is being edited, typically the Tab it's within has been\n  // clicked and is focused/active. for accessibility, when focused the Tab <a /> intercepts\n  // the ' ' key (among others, including all arrows) and onChange() doesn't fire. somehow\n  // keydown is still called so we can detect this and manually add a ' ' to the current title\n  function handleKeyDown(event) {\n    if (event.key === ' ') {\n      event.stopPropagation();\n    }\n  }\n  function handleChange(ev) {\n    if (!canEdit) {\n      return;\n    }\n    setCurrentTitle(ev.target.value);\n  }\n  function handleKeyPress(ev) {\n    if (ev.key === 'Enter') {\n      ev.preventDefault();\n      handleBlur();\n    }\n  }\n  let value;\n  if (currentTitle) {\n    value = currentTitle;\n  } else\n  if (!isEditing) {\n    value = emptyText;\n  }\n  // Construct an inline style based on previously-saved height of the rendered label. Only\n  // used in multi-line contexts.\n  const editStyle = isEditing && contentBoundingRect ?\n  { height: `${contentBoundingRect.height}px` } :\n  undefined;\n  // Create a textarea when we're editing a multi-line value, otherwise create an input (which may\n  // be text or a button).\n  let titleComponent = multiLine && isEditing ? ___EmotionJSX(\"textarea\", { \"data-test\": \"editable-title-input\", ref: contentRef, required: true, value: value, className: !title ? 'text-muted' : undefined, onKeyDown: handleKeyDown, onChange: handleChange, onBlur: handleBlur, onClick: handleClick, onKeyPress: handleKeyPress, style: editStyle }) : ___EmotionJSX(\"input\", { \"data-test\": \"editable-title-input\", ref: contentRef, required: true, type: isEditing ? 'text' : 'button', value: value, className: !title ? 'text-muted' : undefined, onKeyDown: handleKeyDown, onChange: handleChange, onBlur: handleBlur, onClick: handleClick, onKeyPress: handleKeyPress });\n  if (showTooltip && !isEditing) {\n    titleComponent = ___EmotionJSX(TooltipWrapper, { label: \"title\", tooltip: canEdit ?\n      t('Click to edit') :\n      noPermitTooltip ||\n      t(\"You don't have the rights to alter this title.\") },\n    titleComponent);\n\n  }\n  if (!canEdit) {\n    // don't actually want an input in this case\n    titleComponent = ___EmotionJSX(\"span\", { \"data-test\": \"editable-title-input\", title: value },\n    value);\n\n  }\n  return ___EmotionJSX(\"span\", { \"data-test\": \"editable-title\", className: cx('editable-title', extraClasses, canEdit && 'editable-title--editable', isEditing && 'editable-title--editing'), style: style },\n  titleComponent);\n\n}__signature__(EditableTitle, \"useState{[isEditing, setIsEditing](false)}\\nuseState{[currentTitle, setCurrentTitle](title)}\\nuseState{[lastTitle, setLastTitle](title)}\\nuseState{[contentBoundingRect, setContentBoundingRect,](null)}\\nuseRef{contentRef}\\nuseEffect{}\");;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(EditableTitle, \"EditableTitle\", \"/app/superset-frontend/src/components/EditableTitle.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/components/EditableTitle.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState, useRef } from 'react';\nimport cx from 'classnames';\nimport { t } from '@superset-ui/core';\nimport TooltipWrapper from './TooltipWrapper';\n\ninterface EditableTitleProps {\n  canEdit?: boolean;\n  emptyText?: string;\n  extraClasses?: Array<string> | string;\n  multiLine?: boolean;\n  noPermitTooltip?: string;\n  onSaveTitle: (arg0: string) => {};\n  showTooltip?: boolean;\n  style?: object;\n  title: string;\n}\n\nexport default function EditableTitle({\n  canEdit = false,\n  emptyText,\n  extraClasses,\n  multiLine = false,\n  noPermitTooltip,\n  onSaveTitle,\n  showTooltip = true,\n  style,\n  title,\n}: EditableTitleProps) {\n  const [isEditing, setIsEditing] = useState(false);\n  const [currentTitle, setCurrentTitle] = useState(title);\n  const [lastTitle, setLastTitle] = useState(title);\n  const [\n    contentBoundingRect,\n    setContentBoundingRect,\n  ] = useState<DOMRect | null>(null);\n  // Used so we can access the DOM element if a user clicks on this component.\n\n  const contentRef = useRef<any | HTMLInputElement | HTMLTextAreaElement>();\n\n  useEffect(() => {\n    if (title !== currentTitle) {\n      setLastTitle(currentTitle);\n      setCurrentTitle(title);\n    }\n  }, [title]);\n\n  function handleClick() {\n    if (!canEdit || isEditing) {\n      return;\n    }\n\n    // For multi-line values, save the actual rendered size of the displayed text.\n    // Later, if a textarea is constructed for editing the value, we'll need this.\n    const contentBounding = contentRef.current\n      ? contentRef.current.getBoundingClientRect()\n      : null;\n    setIsEditing(true);\n    setContentBoundingRect(contentBounding);\n  }\n\n  function handleBlur() {\n    const formattedTitle = currentTitle.trim();\n\n    if (!canEdit) {\n      return;\n    }\n\n    setIsEditing(false);\n\n    if (!formattedTitle.length) {\n      setCurrentTitle(lastTitle);\n      return;\n    }\n\n    if (lastTitle !== formattedTitle) {\n      setLastTitle(formattedTitle);\n    }\n\n    if (title !== formattedTitle) {\n      onSaveTitle(formattedTitle);\n    }\n  }\n\n  // this entire method exists to support using EditableTitle as the title of a\n  // react-bootstrap Tab, as a workaround for this line in react-bootstrap https://goo.gl/ZVLmv4\n  //\n  // tl;dr when a Tab EditableTitle is being edited, typically the Tab it's within has been\n  // clicked and is focused/active. for accessibility, when focused the Tab <a /> intercepts\n  // the ' ' key (among others, including all arrows) and onChange() doesn't fire. somehow\n  // keydown is still called so we can detect this and manually add a ' ' to the current title\n  function handleKeyDown(event: any) {\n    if (event.key === ' ') {\n      event.stopPropagation();\n    }\n  }\n\n  function handleChange(ev: any) {\n    if (!canEdit) {\n      return;\n    }\n    setCurrentTitle(ev.target.value);\n  }\n\n  function handleKeyPress(ev: any) {\n    if (ev.key === 'Enter') {\n      ev.preventDefault();\n      handleBlur();\n    }\n  }\n\n  let value: string | undefined;\n  if (currentTitle) {\n    value = currentTitle;\n  } else if (!isEditing) {\n    value = emptyText;\n  }\n\n  // Construct an inline style based on previously-saved height of the rendered label. Only\n  // used in multi-line contexts.\n  const editStyle =\n    isEditing && contentBoundingRect\n      ? { height: `${contentBoundingRect.height}px` }\n      : undefined;\n\n  // Create a textarea when we're editing a multi-line value, otherwise create an input (which may\n  // be text or a button).\n  let titleComponent =\n    multiLine && isEditing ? (\n      <textarea\n        data-test=\"editable-title-input\"\n        ref={contentRef}\n        required\n        value={value}\n        className={!title ? 'text-muted' : undefined}\n        onKeyDown={handleKeyDown}\n        onChange={handleChange}\n        onBlur={handleBlur}\n        onClick={handleClick}\n        onKeyPress={handleKeyPress}\n        style={editStyle}\n      />\n    ) : (\n      <input\n        data-test=\"editable-title-input\"\n        ref={contentRef}\n        required\n        type={isEditing ? 'text' : 'button'}\n        value={value}\n        className={!title ? 'text-muted' : undefined}\n        onKeyDown={handleKeyDown}\n        onChange={handleChange}\n        onBlur={handleBlur}\n        onClick={handleClick}\n        onKeyPress={handleKeyPress}\n      />\n    );\n  if (showTooltip && !isEditing) {\n    titleComponent = (\n      <TooltipWrapper\n        label=\"title\"\n        tooltip={\n          canEdit\n            ? t('Click to edit')\n            : noPermitTooltip ||\n              t(\"You don't have the rights to alter this title.\")\n        }\n      >\n        {titleComponent}\n      </TooltipWrapper>\n    );\n  }\n  if (!canEdit) {\n    // don't actually want an input in this case\n    titleComponent = (\n      <span data-test=\"editable-title-input\" title={value}>\n        {value}\n      </span>\n    );\n  }\n  return (\n    <span\n      data-test=\"editable-title\"\n      className={cx(\n        'editable-title',\n        extraClasses,\n        canEdit && 'editable-title--editable',\n        isEditing && 'editable-title--editing',\n      )}\n      style={style}\n    >\n      {titleComponent}\n    </span>\n  );\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}