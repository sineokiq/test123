{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _Promise from \"@babel/runtime-corejs3/core-js-stable/promise\";import _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t, SupersetClient, logging, styled } from '@superset-ui/core';\nimport rison from 'rison';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nconst createFetchResourceMethod = method => (resource, relation, handleError, userId) => async (filterValue = '', pageIndex, pageSize) => {\n  const resourceEndpoint = `/api/v1/${resource}/${method}/${relation}`;\n  const options = userId && pageIndex === 0 ? [{ label: 'me', value: userId }] : [];\n  try {var _json$result;\n    const queryParams = rison.encode({\n      ...(pageIndex ? { page: pageIndex } : {}),\n      ...(pageSize ? { page_size: pageSize } : {}),\n      ...(filterValue ? { filter: filterValue } : {}) });\n\n    const { json = {} } = await SupersetClient.get({\n      endpoint: `${resourceEndpoint}?q=${queryParams}` });\n\n    const data = json == null ? void 0 : (_json$result = json.result) == null ? void 0 : _mapInstanceProperty(_json$result).call(_json$result, ({ text: label, value }) => ({\n      label,\n      value }));\n\n    return _concatInstanceProperty(options).call(options, data);\n  }\n  catch (e) {\n    handleError(e);\n  }\n  return [];\n};\nexport const getRecentAcitivtyObjs = (userId, recent, addDangerToast) => {\n  const getParams = filters => {\n    const params = {\n      order_column: 'changed_on_delta_humanized',\n      order_direction: 'desc',\n      page: 0,\n      page_size: 3,\n      filters };\n\n    if (!filters)\n    delete params.filters;\n    return rison.encode(params);\n  };\n  const filters = {\n    // chart and dashbaord uses same filters\n    // for edited and created\n    edited: [\n    {\n      col: 'changed_by',\n      opr: 'rel_o_m',\n      value: `${userId}` }],\n\n\n    created: [\n    {\n      col: 'created_by',\n      opr: 'rel_o_m',\n      value: `${userId}` }] };\n\n\n\n  const baseBatch = [\n  SupersetClient.get({ endpoint: recent }),\n  SupersetClient.get({\n    endpoint: `/api/v1/dashboard/?q=${getParams(filters.edited)}` }),\n\n  SupersetClient.get({\n    endpoint: `/api/v1/chart/?q=${getParams(filters.edited)}` }),\n\n  SupersetClient.get({\n    endpoint: `/api/v1/dashboard/?q=${getParams(filters.created)}` }),\n\n  SupersetClient.get({\n    endpoint: `/api/v1/chart/?q=${getParams(filters.created)}` }),\n\n  SupersetClient.get({\n    endpoint: `/api/v1/saved_query/?q=${getParams(filters.created)}` })];\n\n\n  return _Promise.all(baseBatch).then(([recentsRes, editedDash, editedChart, createdByDash, createdByChart, createdByQuery]) => {var _editedDash$json, _context, _editedChart$json, _context2, _createdByDash$json, _context3, _createdByChart$json, _context4, _createdByQuery$json, _context5;\n    const res = {\n      editedDash: (_editedDash$json = editedDash.json) == null ? void 0 : _sliceInstanceProperty(_context = _editedDash$json.result).call(_context, 0, 3),\n      editedChart: (_editedChart$json = editedChart.json) == null ? void 0 : _sliceInstanceProperty(_context2 = _editedChart$json.result).call(_context2, 0, 3),\n      createdByDash: (_createdByDash$json = createdByDash.json) == null ? void 0 : _sliceInstanceProperty(_context3 = _createdByDash$json.result).call(_context3, 0, 3),\n      createdByChart: (_createdByChart$json = createdByChart.json) == null ? void 0 : _sliceInstanceProperty(_context4 = _createdByChart$json.result).call(_context4, 0, 3),\n      createdByQuery: (_createdByQuery$json = createdByQuery.json) == null ? void 0 : _sliceInstanceProperty(_context5 = _createdByQuery$json.result).call(_context5, 0, 3) };\n\n    if (recentsRes.json.length === 0) {\n      const newBatch = [\n      SupersetClient.get({ endpoint: `/api/v1/chart/?q=${getParams()}` }),\n      SupersetClient.get({\n        endpoint: `/api/v1/dashboard/?q=${getParams()}` })];\n\n\n      return _Promise.all(newBatch).\n      then(([chartRes, dashboardRes]) => {\n        res.examples = [\n        ...chartRes.json.result,\n        ...dashboardRes.json.result];\n\n        return res;\n      }).\n      catch(e => addDangerToast(t('There was an error fetching your recent activity:'), e));\n    }\n    res.viewed = recentsRes.json;\n    return res;\n  });\n};\nexport const createFetchRelated = createFetchResourceMethod('related');\nexport const createFetchDistinct = createFetchResourceMethod('distinct');\nexport function createErrorHandler(handleErrorFunc) {\n  return async e => {\n    const parsedError = await getClientErrorObject(e);\n    logging.error(e);\n    handleErrorFunc(parsedError.message || parsedError.error);\n  };\n}\nexport function handleChartDelete({ id, slice_name: sliceName }, addSuccessToast, addDangerToast, refreshData, chartFilter, userId) {\n  const filters = {\n    pageIndex: 0,\n    pageSize: 3,\n    sortBy: [\n    {\n      id: 'changed_on_delta_humanized',\n      desc: true }],\n\n\n    filters: [\n    {\n      id: 'created_by',\n      operator: 'rel_o_m',\n      value: `${userId}` }] };\n\n\n\n  SupersetClient.delete({\n    endpoint: `/api/v1/chart/${id}` }).\n  then(() => {\n    if (chartFilter === 'Mine')\n    refreshData(filters);else\n\n    refreshData();\n    addSuccessToast(t('Deleted: %s', sliceName));\n  }, () => {\n    addDangerToast(t('There was an issue deleting: %s', sliceName));\n  });\n}\nexport function handleBulkChartExport(chartsToExport) {\n  return window.location.assign(`/api/v1/chart/export/?q=${rison.encode(_mapInstanceProperty(chartsToExport).call(chartsToExport, ({ id }) => id))}`);\n}\nexport function handleBulkDashboardExport(dashboardsToExport) {\n  return window.location.assign(`/api/v1/dashboard/export/?q=${rison.encode(_mapInstanceProperty(dashboardsToExport).call(dashboardsToExport, ({ id }) => id))}`);\n}\nexport function handleDashboardDelete({ id, dashboard_title: dashboardTitle }, refreshData, addSuccessToast, addDangerToast, dashboardFilter, userId) {\n  return SupersetClient.delete({\n    endpoint: `/api/v1/dashboard/${id}` }).\n  then(() => {\n    const filters = {\n      pageIndex: 0,\n      pageSize: 3,\n      sortBy: [\n      {\n        id: 'changed_on_delta_humanized',\n        desc: true }],\n\n\n      filters: [\n      {\n        id: 'owners',\n        operator: 'rel_m_m',\n        value: `${userId}` }] };\n\n\n\n    if (dashboardFilter === 'Mine')\n    refreshData(filters);else\n\n    refreshData();\n    addSuccessToast(t('Deleted: %s', dashboardTitle));\n  }, createErrorHandler(errMsg => addDangerToast(t('There was an issue deleting %s: %s', dashboardTitle, errMsg))));\n}\nexport function shortenSQL(sql, maxLines) {\n  let lines = sql.split('\\n');\n  if (lines.length >= maxLines) {\n    lines = _sliceInstanceProperty(lines).call(lines, 0, maxLines);\n    lines.push('...');\n  }\n  return lines.join('\\n');\n}\nconst breakpoints = [576, 768, 992, 1200];\nexport const mq = _mapInstanceProperty(breakpoints).call(breakpoints, bp => `@media (max-width: ${bp}px)`);\nexport const CardContainer = styled.div`\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(31%, 31%));\n  ${[mq[3]]} {\n    grid-template-columns: repeat(auto-fit, minmax(31%, 31%));\n  }\n\n  ${[mq[2]]} {\n    grid-template-columns: repeat(auto-fit, minmax(48%, 48%));\n  }\n\n  ${[mq[1]]} {\n    grid-template-columns: repeat(auto-fit, minmax(50%, 80%));\n  }\n  grid-gap: ${({ theme }) => theme.gridUnit * 8}px;\n  justify-content: left;\n  padding: ${({ theme }) => theme.gridUnit * 6}px;\n  padding-top: ${({ theme }) => theme.gridUnit * 2}px;\n`;\nexport const CardStyles = styled.div`\n  cursor: pointer;\n  a {\n    text-decoration: none;\n  }\n`;\nexport const IconContainer = styled.div`\n  svg {\n    vertical-align: -7px;\n    color: ${({ theme }) => theme.colors.primary.dark1};\n  }\n`;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(createFetchResourceMethod, \"createFetchResourceMethod\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(getRecentAcitivtyObjs, \"getRecentAcitivtyObjs\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(createFetchRelated, \"createFetchRelated\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(createFetchDistinct, \"createFetchDistinct\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(createErrorHandler, \"createErrorHandler\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(handleChartDelete, \"handleChartDelete\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(handleBulkChartExport, \"handleBulkChartExport\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(handleBulkDashboardExport, \"handleBulkDashboardExport\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(handleDashboardDelete, \"handleDashboardDelete\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(shortenSQL, \"shortenSQL\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(breakpoints, \"breakpoints\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(mq, \"mq\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(CardContainer, \"CardContainer\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(CardStyles, \"CardStyles\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(IconContainer, \"IconContainer\", \"/app/superset-frontend/src/views/CRUD/utils.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/views/CRUD/utils.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  t,\n  SupersetClient,\n  SupersetClientResponse,\n  logging,\n  styled,\n} from '@superset-ui/core';\nimport Chart from 'src/types/Chart';\nimport rison from 'rison';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { FetchDataConfig } from 'src/components/ListView';\nimport { Dashboard } from './types';\n\nconst createFetchResourceMethod = (method: string) => (\n  resource: string,\n  relation: string,\n  handleError: (error: Response) => void,\n  userId?: string | number,\n) => async (filterValue = '', pageIndex?: number, pageSize?: number) => {\n  const resourceEndpoint = `/api/v1/${resource}/${method}/${relation}`;\n  const options =\n    userId && pageIndex === 0 ? [{ label: 'me', value: userId }] : [];\n  try {\n    const queryParams = rison.encode({\n      ...(pageIndex ? { page: pageIndex } : {}),\n      ...(pageSize ? { page_size: pageSize } : {}),\n      ...(filterValue ? { filter: filterValue } : {}),\n    });\n    const { json = {} } = await SupersetClient.get({\n      endpoint: `${resourceEndpoint}?q=${queryParams}`,\n    });\n    const data = json?.result?.map(\n      ({ text: label, value }: { text: string; value: any }) => ({\n        label,\n        value,\n      }),\n    );\n\n    return options.concat(data);\n  } catch (e) {\n    handleError(e);\n  }\n  return [];\n};\n\nexport const getRecentAcitivtyObjs = (\n  userId: string | number,\n  recent: string,\n  addDangerToast: (arg1: string, arg2: any) => any,\n) => {\n  const getParams = (filters?: Array<any>) => {\n    const params = {\n      order_column: 'changed_on_delta_humanized',\n      order_direction: 'desc',\n      page: 0,\n      page_size: 3,\n      filters,\n    };\n    if (!filters) delete params.filters;\n    return rison.encode(params);\n  };\n  const filters = {\n    // chart and dashbaord uses same filters\n    // for edited and created\n    edited: [\n      {\n        col: 'changed_by',\n        opr: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n    created: [\n      {\n        col: 'created_by',\n        opr: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n  };\n  const baseBatch = [\n    SupersetClient.get({ endpoint: recent }),\n    SupersetClient.get({\n      endpoint: `/api/v1/dashboard/?q=${getParams(filters.edited)}`,\n    }),\n    SupersetClient.get({\n      endpoint: `/api/v1/chart/?q=${getParams(filters.edited)}`,\n    }),\n    SupersetClient.get({\n      endpoint: `/api/v1/dashboard/?q=${getParams(filters.created)}`,\n    }),\n    SupersetClient.get({\n      endpoint: `/api/v1/chart/?q=${getParams(filters.created)}`,\n    }),\n    SupersetClient.get({\n      endpoint: `/api/v1/saved_query/?q=${getParams(filters.created)}`,\n    }),\n  ];\n  return Promise.all(baseBatch).then(\n    ([\n      recentsRes,\n      editedDash,\n      editedChart,\n      createdByDash,\n      createdByChart,\n      createdByQuery,\n    ]) => {\n      const res: any = {\n        editedDash: editedDash.json?.result.slice(0, 3),\n        editedChart: editedChart.json?.result.slice(0, 3),\n        createdByDash: createdByDash.json?.result.slice(0, 3),\n        createdByChart: createdByChart.json?.result.slice(0, 3),\n        createdByQuery: createdByQuery.json?.result.slice(0, 3),\n      };\n      if (recentsRes.json.length === 0) {\n        const newBatch = [\n          SupersetClient.get({ endpoint: `/api/v1/chart/?q=${getParams()}` }),\n          SupersetClient.get({\n            endpoint: `/api/v1/dashboard/?q=${getParams()}`,\n          }),\n        ];\n        return Promise.all(newBatch)\n          .then(([chartRes, dashboardRes]) => {\n            res.examples = [\n              ...chartRes.json.result,\n              ...dashboardRes.json.result,\n            ];\n            return res;\n          })\n          .catch(e =>\n            addDangerToast(\n              t('There was an error fetching your recent activity:'),\n              e,\n            ),\n          );\n      }\n      res.viewed = recentsRes.json;\n      return res;\n    },\n  );\n};\n\nexport const createFetchRelated = createFetchResourceMethod('related');\nexport const createFetchDistinct = createFetchResourceMethod('distinct');\n\nexport function createErrorHandler(handleErrorFunc: (errMsg?: string) => void) {\n  return async (e: SupersetClientResponse | string) => {\n    const parsedError = await getClientErrorObject(e);\n    logging.error(e);\n    handleErrorFunc(parsedError.message || parsedError.error);\n  };\n}\n\nexport function handleChartDelete(\n  { id, slice_name: sliceName }: Chart,\n  addSuccessToast: (arg0: string) => void,\n  addDangerToast: (arg0: string) => void,\n  refreshData: (arg0?: FetchDataConfig | null) => void,\n  chartFilter?: string,\n  userId?: number,\n) {\n  const filters = {\n    pageIndex: 0,\n    pageSize: 3,\n    sortBy: [\n      {\n        id: 'changed_on_delta_humanized',\n        desc: true,\n      },\n    ],\n    filters: [\n      {\n        id: 'created_by',\n        operator: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n  };\n  SupersetClient.delete({\n    endpoint: `/api/v1/chart/${id}`,\n  }).then(\n    () => {\n      if (chartFilter === 'Mine') refreshData(filters);\n      else refreshData();\n      addSuccessToast(t('Deleted: %s', sliceName));\n    },\n    () => {\n      addDangerToast(t('There was an issue deleting: %s', sliceName));\n    },\n  );\n}\n\nexport function handleBulkChartExport(chartsToExport: Chart[]) {\n  return window.location.assign(\n    `/api/v1/chart/export/?q=${rison.encode(\n      chartsToExport.map(({ id }) => id),\n    )}`,\n  );\n}\n\nexport function handleBulkDashboardExport(dashboardsToExport: Dashboard[]) {\n  return window.location.assign(\n    `/api/v1/dashboard/export/?q=${rison.encode(\n      dashboardsToExport.map(({ id }) => id),\n    )}`,\n  );\n}\n\nexport function handleDashboardDelete(\n  { id, dashboard_title: dashboardTitle }: Dashboard,\n  refreshData: (config?: FetchDataConfig | null) => void,\n  addSuccessToast: (arg0: string) => void,\n  addDangerToast: (arg0: string) => void,\n  dashboardFilter?: string,\n  userId?: number,\n) {\n  return SupersetClient.delete({\n    endpoint: `/api/v1/dashboard/${id}`,\n  }).then(\n    () => {\n      const filters = {\n        pageIndex: 0,\n        pageSize: 3,\n        sortBy: [\n          {\n            id: 'changed_on_delta_humanized',\n            desc: true,\n          },\n        ],\n        filters: [\n          {\n            id: 'owners',\n            operator: 'rel_m_m',\n            value: `${userId}`,\n          },\n        ],\n      };\n      if (dashboardFilter === 'Mine') refreshData(filters);\n      else refreshData();\n      addSuccessToast(t('Deleted: %s', dashboardTitle));\n    },\n    createErrorHandler(errMsg =>\n      addDangerToast(\n        t('There was an issue deleting %s: %s', dashboardTitle, errMsg),\n      ),\n    ),\n  );\n}\n\nexport function shortenSQL(sql: string, maxLines: number) {\n  let lines: string[] = sql.split('\\n');\n  if (lines.length >= maxLines) {\n    lines = lines.slice(0, maxLines);\n    lines.push('...');\n  }\n  return lines.join('\\n');\n}\n\nconst breakpoints = [576, 768, 992, 1200];\nexport const mq = breakpoints.map(bp => `@media (max-width: ${bp}px)`);\n\nexport const CardContainer = styled.div`\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(31%, 31%));\n  ${[mq[3]]} {\n    grid-template-columns: repeat(auto-fit, minmax(31%, 31%));\n  }\n\n  ${[mq[2]]} {\n    grid-template-columns: repeat(auto-fit, minmax(48%, 48%));\n  }\n\n  ${[mq[1]]} {\n    grid-template-columns: repeat(auto-fit, minmax(50%, 80%));\n  }\n  grid-gap: ${({ theme }) => theme.gridUnit * 8}px;\n  justify-content: left;\n  padding: ${({ theme }) => theme.gridUnit * 6}px;\n  padding-top: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nexport const CardStyles = styled.div`\n  cursor: pointer;\n  a {\n    text-decoration: none;\n  }\n`;\n\nexport const IconContainer = styled.div`\n  svg {\n    vertical-align: -7px;\n    color: ${({ theme }) => theme.colors.primary.dark1};\n  }\n`;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}