{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _Object$entries from \"@babel/runtime-corejs3/core-js-stable/object/entries\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";import _someInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/some\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _debounce from \"lodash/debounce\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { styled, t, supersetTheme, css } from '@superset-ui/core';\n\nimport { Resizable } from 're-resizable';\n\nimport { useDynamicPluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/core';\nimport { Tooltip } from 'src/common/components/Tooltip';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport Icon from 'src/components/Icon';\nimport ExploreChartPanel from './ExploreChartPanel';\nimport ConnectedControlPanelsContainer from './ControlPanelsContainer';\nimport SaveModal from './SaveModal';\nimport QueryAndSaveBtns from './QueryAndSaveBtns';\nimport DataSourcePanel from './DatasourcePanel';\nimport { getExploreLongUrl } from '../exploreUtils';\nimport { areObjectsEqual } from '../../reduxUtils';\nimport { getFormDataFromControls } from '../controlUtils';\nimport { chartPropShape } from '../../dashboard/util/propShapes';\nimport * as exploreActions from '../actions/exploreActions';\nimport * as saveModalActions from '../actions/saveModalActions';\nimport * as chartActions from '../../chart/chartAction';\nimport { fetchDatasourceMetadata } from '../../dashboard/actions/datasources';\nimport * as logActions from '../../logger/actions';\nimport {\nLOG_ACTIONS_MOUNT_EXPLORER,\nLOG_ACTIONS_CHANGE_EXPLORE_CONTROLS } from\n'../../logger/LogUtils';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  height: PropTypes.string,\n  width: PropTypes.string,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.bool.isRequired,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string };\n\n\nconst Styles = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  text-align: left;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  align-items: stretch;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .explore-column {\n    display: flex;\n    flex-direction: column;\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    max-height: 100%;\n  }\n  .data-source-selection {\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .main-explore-content {\n    flex: 1;\n    min-width: ${({ theme }) => theme.gridUnit * 128}px;\n    border-left: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    .panel {\n      margin-bottom: 0;\n    }\n  }\n  .controls-column {\n    align-self: flex-start;\n    padding: 0;\n  }\n  .title-container {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    padding: 0 ${({ theme }) => 2 * theme.gridUnit}px;\n    justify-content: space-between;\n    .horizontal-text {\n      text-transform: uppercase;\n      color: ${({ theme }) => theme.colors.grayscale.light1};\n      font-size: ${({ theme }) => 4 * theme.typography.sizes.s};\n    }\n  }\n  .no-show {\n    display: none;\n  }\n  .vertical-text {\n    writing-mode: vertical-rl;\n    text-orientation: mixed;\n  }\n  .sidebar {\n    height: 100%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n    width: ${({ theme }) => 8 * theme.gridUnit}px;\n  }\n  .callpase-icon > svg {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst getWindowSize = () => ({\n  height: window.innerHeight,\n  width: window.innerWidth });\n\n\nfunction useWindowSize({ delayMs = 250 } = {}) {\n  const [size, setSize] = useState(getWindowSize());\n\n  useEffect(() => {\n    const onWindowResize = _debounce(() => setSize(getWindowSize()), delayMs);\n    window.addEventListener('resize', onWindowResize);\n    return () => window.removeEventListener('resize', onWindowResize);\n  }, []);\n\n  return size;\n}__signature__(useWindowSize, \"useState{[size, setSize](getWindowSize())}\\nuseEffect{}\");\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = useDynamicPluginContext();\n  const dynamicPlugin = dynamicPluginContext.plugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.loading;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  const previousControls = usePrevious(props.controls);\n  const windowSize = useWindowSize();\n\n  const [showingModal, setShowingModal] = useState(false);\n  const [chartIsStale, setChartIsStale] = useState(false);\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const width = `${windowSize.width}px`;\n  const navHeight = props.standalone ? 0 : 90;\n  const height = props.forcedHeight ?\n  `${props.forcedHeight}px` :\n  `${windowSize.height - navHeight}px`;\n\n  const storageKeys = {\n    controlsWidth: 'controls_width',\n    dataSourceWidth: 'datasource_width' };\n\n\n  const defaultSidebarsWidth = {\n    controls_width: 320,\n    datasource_width: 300 };\n\n\n  function addHistory({ isReplace = false, title } = {}) {\n    const payload = { ...props.form_data };\n    const longUrl = getExploreLongUrl(\n    props.form_data,\n    props.standalone ? 'standalone' : null,\n    false);\n\n    try {\n      if (isReplace) {\n        window.history.replaceState(payload, title, longUrl);\n      } else {\n        window.history.pushState(payload, title, longUrl);\n      }\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\n      'Failed at altering browser history',\n      payload,\n      title,\n      longUrl);\n\n    }\n  }\n\n  function handlePopstate() {\n    const formData = window.history.state;\n    if (formData && _Object$keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n      formData,\n      false,\n      props.timeout,\n      props.chart.id);\n\n    }\n  }\n\n  function onQuery() {\n    // remove alerts when query\n    props.actions.removeControlPanelAlert();\n    props.actions.triggerQuery(true, props.chart.id);\n\n    setChartIsStale(false);\n    addHistory();\n  }\n\n  function handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand) {\n      const isEnter = event.key === 'Enter' || event.keyCode === 13;\n      const isS = event.key === 's' || event.keyCode === 83;\n      if (isEnter) {\n        onQuery();\n      } else if (isS) {\n        if (_sliceInstanceProperty(props)) {\n          props.actions.\n          saveSlice(props.form_data, {\n            action: 'overwrite',\n            slice_id: _sliceInstanceProperty(props).slice_id,\n            slice_name: _sliceInstanceProperty(props).slice_name,\n            add_to_dash: 'noSave',\n            goto_dash: false }).\n\n          then(({ data }) => {\n            window.location = _sliceInstanceProperty(data).slice_url;\n          });\n        }\n      }\n    }\n  }\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleModal() {\n    setShowingModal(!showingModal);\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  // effect to run on mount\n  useEffect(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n    addHistory({ isReplace: true });\n    window.addEventListener('popstate', handlePopstate);\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {var _context;\n    const hasError = _someInstanceProperty(_context = _Object$values(props.controls)).call(_context,\n    (control) =>\n    control.validationErrors && control.validationErrors.length > 0);\n\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (previousControls) {var _context2;\n      if (props.controls.viz_type.value !== previousControls.viz_type.value) {\n        props.actions.resetControls();\n      }\n      if (\n      props.controls.datasource && (\n      previousControls.datasource == null ||\n      props.controls.datasource.value !== previousControls.datasource.value))\n      {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = _filterInstanceProperty(_context2 = _Object$keys(props.controls)).call(_context2,\n      (key) =>\n      typeof previousControls[key] !== 'undefined' &&\n      !areObjectsEqual(\n      props.controls[key].value,\n      previousControls[key].value));\n\n\n\n      // this should also be handled by the actions that are actually changing the controls\n      const hasDisplayControlChanged = _someInstanceProperty(changedControlKeys).call(changedControlKeys,\n      key => props.controls[key].renderTrigger);\n\n      if (hasDisplayControlChanged) {\n        props.actions.updateQueryFormData(\n        getFormDataFromControls(props.controls),\n        props.chart.id);\n\n        props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n        addHistory();\n      }\n\n      // this should be handled inside actions too\n      const hasQueryControlChanged = _someInstanceProperty(changedControlKeys).call(changedControlKeys,\n      (key) =>\n      !props.controls[key].renderTrigger &&\n      !props.controls[key].dontRefreshOnChange);\n\n      if (hasQueryControlChanged) {\n        props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n        setChartIsStale(true);\n      }\n    }\n  }, [props.controls]);\n\n  function renderErrorMessage() {var _context3, _context4;\n    // Returns an error message as a node if any errors are in the store\n    const errors = _mapInstanceProperty(_context3 = _filterInstanceProperty(_context4 = _Object$entries(props.controls)).call(_context4,\n\n    ([, control]) =>\n    control.validationErrors && control.validationErrors.length > 0)).call(_context3,\n\n    ([key, control]) =>\n    ___EmotionJSX(\"div\", { key: key },\n    t('Control labeled '),\n    ___EmotionJSX(\"strong\", null, ` \"${control.label}\" `),\n    control.validationErrors.join('. ')));\n\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = ___EmotionJSX(\"div\", { style: { textAlign: 'left' } }, errors);\n    }\n    return errorMessage;\n  }\n\n  function renderChartContainer() {\n    return (\n      ___EmotionJSX(ExploreChartPanel, _extends({\n        width: width,\n        height: height },\n      props, {\n        errorMessage: renderErrorMessage(),\n        refreshOverlayVisible: chartIsStale,\n        addHistory: addHistory,\n        onQuery: onQuery })));\n\n\n  }\n\n  function getSidebarWidths(key) {\n    try {\n      return localStorage.getItem(key) || defaultSidebarsWidth[key];\n    } catch {\n      return defaultSidebarsWidth[key];\n    }\n  }\n\n  function setSidebarWidths(key, dimension) {\n    try {\n      const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n      localStorage.setItem(key, newDimension);\n    } catch {\n      // Catch in case localStorage is unavailable\n    }\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    ___EmotionJSX(Styles, { id: \"explore-container\", height: height },\n    ___EmotionJSX(Global, {\n      styles: css`\n          .navbar {\n            margin-bottom: 0;\n          }\n          body {\n            max-height: 100vh;\n            overflow: hidden;\n          }\n          #app-menu,\n          #app {\n            flex: 1 1 auto;\n          }\n          #app {\n            flex-basis: 100%;\n            overflow: hidden;\n            height: 100vh;\n          }\n          #app-menu {\n            flex-shrink: 0;\n          }\n        ` }),\n\n    showingModal &&\n    ___EmotionJSX(SaveModal, {\n      onHide: toggleModal,\n      actions: props.actions,\n      form_data: props.form_data,\n      sliceName: props.sliceName,\n      dashboardId: props.dashboardId }),\n\n\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) =>\n      setSidebarWidths(storageKeys.dataSourceWidth, d),\n\n      defaultSize: {\n        width: getSidebarWidths(storageKeys.dataSourceWidth),\n        height: '100%' },\n\n      minWidth: defaultSidebarsWidth[storageKeys.dataSourceWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className:\n      isCollapsed ? 'no-show' : 'explore-column data-source-selection' },\n\n\n    ___EmotionJSX(\"div\", { className: \"title-container\" },\n    ___EmotionJSX(\"span\", { className: \"horizont al-text\" }, t('Dataset')),\n    ___EmotionJSX(\"span\", {\n      role: \"button\",\n      tabIndex: 0,\n      className: \"action-button\",\n      onClick: toggleCollapse },\n\n    ___EmotionJSX(Icon, {\n      name: \"expand\",\n      color: supersetTheme.colors.primary.base,\n      className: \"collapse-icon\",\n      width: 16 }))),\n\n\n\n    ___EmotionJSX(DataSourcePanel, {\n      datasource: props.datasource,\n      controls: props.controls,\n      actions: props.actions })),\n\n\n    isCollapsed ?\n    ___EmotionJSX(\"div\", {\n      className: \"sidebar\",\n      onClick: toggleCollapse,\n      \"data-test\": \"open-datasource-tab\",\n      role: \"button\",\n      tabIndex: 0 },\n\n    ___EmotionJSX(\"span\", { role: \"button\", tabIndex: 0, className: \"action-button\" },\n    ___EmotionJSX(Tooltip, { title: t('Open Datasource tab') },\n    ___EmotionJSX(Icon, {\n      name: \"collapse\",\n      color: supersetTheme.colors.primary.base,\n      className: \"collapse-icon\",\n      width: 16 }))),\n\n\n\n    ___EmotionJSX(Icon, { name: \"dataset-physical\", width: 16 })) :\n\n    null,\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) =>\n      setSidebarWidths(storageKeys.controlsWidth, d),\n\n      defaultSize: {\n        width: getSidebarWidths(storageKeys.controlsWidth),\n        height: '100%' },\n\n      minWidth: defaultSidebarsWidth[storageKeys.controlsWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className: \"col-sm-3 explore-column controls-column\" },\n\n    ___EmotionJSX(QueryAndSaveBtns, {\n      canAdd: !!(props.can_add || props.can_overwrite),\n      onQuery: onQuery,\n      onSave: toggleModal,\n      onStop: onStop,\n      loading: props.chart.chartStatus === 'loading',\n      chartIsStale: chartIsStale,\n      errorMessage: renderErrorMessage(),\n      datasourceType: props.datasource_type }),\n\n    ___EmotionJSX(ConnectedControlPanelsContainer, {\n      actions: props.actions,\n      form_data: props.form_data,\n      controls: props.controls,\n      datasource_type: props.datasource_type,\n      isDatasourceMetaLoading: props.isDatasourceMetaLoading })),\n\n\n    ___EmotionJSX(\"div\", {\n      className: `main-explore-content ${\n      isCollapsed ? 'col-sm-9' : 'col-sm-7'\n      }` },\n\n    renderChartContainer())));\n\n\n\n}__signature__(ExploreViewContainer, \"useDynamicPluginContext{dynamicPluginContext}\\nusePrevious{wasDynamicPluginLoading}\\nusePrevious{previousControls}\\nuseWindowSize{windowSize}\\nuseState{[showingModal, setShowingModal](false)}\\nuseState{[chartIsStale, setChartIsStale](false)}\\nuseState{[isCollapsed, setIsCollapsed](false)}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\", () => [useDynamicPluginContext, usePrevious, usePrevious, useWindowSize]);\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {\n  const { explore, charts, impressionId } = state;\n  const form_data = getFormDataFromControls(explore.controls);\n  const chartKey = _Object$keys(charts)[0];\n  const chart = charts[chartKey];\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource: explore.datasource,\n    datasource_type: explore.datasource.type,\n    datasourceId: explore.datasource_id,\n    dashboardId: explore.form_data ? explore.form_data.dashboardId : undefined,\n    controls: explore.controls,\n    can_overwrite: !!explore.can_overwrite,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    column_formats: explore.datasource ?\n    explore.datasource.column_formats :\n    null,\n    containerId: _sliceInstanceProperty(explore) ?\n    `slice-container-${_sliceInstanceProperty(explore).slice_id}` :\n    'slice-container',\n    isStarred: explore.isStarred,\n    slice: _sliceInstanceProperty(explore),\n    sliceName: explore.sliceName,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: form_data.datasource_name,\n    vizType: form_data.viz_type,\n    standalone: explore.standalone,\n    forcedHeight: explore.forced_height,\n    chart,\n    timeout: explore.common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    impressionId };\n\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions };\n\n  return {\n    actions: bindActionCreators(actions, dispatch) };\n\n}const _default =\n\nconnect(\nmapStateToProps,\nmapDispatchToProps)(\nExploreViewContainer);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(Styles, \"Styles\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(getWindowSize, \"getWindowSize\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(useWindowSize, \"useWindowSize\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(ExploreViewContainer, \"ExploreViewContainer\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx"],"names":["React","useEffect","useState","PropTypes","bindActionCreators","connect","styled","t","supersetTheme","css","Resizable","useDynamicPluginContext","Global","Tooltip","usePrevious","Icon","ExploreChartPanel","ConnectedControlPanelsContainer","SaveModal","QueryAndSaveBtns","DataSourcePanel","getExploreLongUrl","areObjectsEqual","getFormDataFromControls","chartPropShape","exploreActions","saveModalActions","chartActions","fetchDatasourceMetadata","logActions","LOG_ACTIONS_MOUNT_EXPLORER","LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS","propTypes","height","string","width","actions","object","isRequired","datasource_type","dashboardId","number","isDatasourceMetaLoading","bool","chart","slice","sliceName","controls","forcedHeight","form_data","standalone","timeout","impressionId","vizType","Styles","div","theme","colors","grayscale","light5","light2","gridUnit","light4","light1","typography","sizes","s","primary","base","getWindowSize","window","innerHeight","innerWidth","useWindowSize","delayMs","size","setSize","onWindowResize","addEventListener","removeEventListener","ExploreViewContainer","props","dynamicPluginContext","dynamicPlugin","plugins","isDynamicPluginLoading","loading","wasDynamicPluginLoading","previousControls","windowSize","showingModal","setShowingModal","chartIsStale","setChartIsStale","isCollapsed","setIsCollapsed","navHeight","storageKeys","controlsWidth","dataSourceWidth","defaultSidebarsWidth","controls_width","datasource_width","addHistory","isReplace","title","payload","longUrl","history","replaceState","pushState","e","console","warn","handlePopstate","formData","state","length","setExploreControls","postChartFormData","id","onQuery","removeControlPanelAlert","triggerQuery","handleKeydown","event","controlOrCommand","ctrlKey","metaKey","isEnter","key","keyCode","isS","saveSlice","action","slice_id","slice_name","add_to_dash","goto_dash","then","data","location","slice_url","onStop","queryController","abort","toggleModal","toggleCollapse","logEvent","document","dynamicPluginControlsReady","hasError","control","validationErrors","viz_type","value","resetControls","datasource","changedControlKeys","hasDisplayControlChanged","renderTrigger","updateQueryFormData","renderTriggered","Date","getTime","hasQueryControlChanged","dontRefreshOnChange","renderErrorMessage","errors","label","join","errorMessage","textAlign","renderChartContainer","getSidebarWidths","localStorage","getItem","setSidebarWidths","dimension","newDimension","Number","setItem","evt","direction","ref","d","right","can_add","can_overwrite","chartStatus","mapStateToProps","explore","charts","chartKey","type","datasourceId","datasource_id","undefined","can_download","column_formats","containerId","isStarred","triggerRender","table_name","datasource_name","forced_height","common","conf","SUPERSET_WEBSERVER_TIMEOUT","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { styled, t, supersetTheme, css } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport { Resizable } from 're-resizable';\n\nimport { useDynamicPluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/core';\nimport { Tooltip } from 'src/common/components/Tooltip';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport Icon from 'src/components/Icon';\nimport ExploreChartPanel from './ExploreChartPanel';\nimport ConnectedControlPanelsContainer from './ControlPanelsContainer';\nimport SaveModal from './SaveModal';\nimport QueryAndSaveBtns from './QueryAndSaveBtns';\nimport DataSourcePanel from './DatasourcePanel';\nimport { getExploreLongUrl } from '../exploreUtils';\nimport { areObjectsEqual } from '../../reduxUtils';\nimport { getFormDataFromControls } from '../controlUtils';\nimport { chartPropShape } from '../../dashboard/util/propShapes';\nimport * as exploreActions from '../actions/exploreActions';\nimport * as saveModalActions from '../actions/saveModalActions';\nimport * as chartActions from '../../chart/chartAction';\nimport { fetchDatasourceMetadata } from '../../dashboard/actions/datasources';\nimport * as logActions from '../../logger/actions';\nimport {\n  LOG_ACTIONS_MOUNT_EXPLORER,\n  LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS,\n} from '../../logger/LogUtils';\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  height: PropTypes.string,\n  width: PropTypes.string,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.bool.isRequired,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string,\n};\n\nconst Styles = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  text-align: left;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  align-items: stretch;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .explore-column {\n    display: flex;\n    flex-direction: column;\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    max-height: 100%;\n  }\n  .data-source-selection {\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .main-explore-content {\n    flex: 1;\n    min-width: ${({ theme }) => theme.gridUnit * 128}px;\n    border-left: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    .panel {\n      margin-bottom: 0;\n    }\n  }\n  .controls-column {\n    align-self: flex-start;\n    padding: 0;\n  }\n  .title-container {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    padding: 0 ${({ theme }) => 2 * theme.gridUnit}px;\n    justify-content: space-between;\n    .horizontal-text {\n      text-transform: uppercase;\n      color: ${({ theme }) => theme.colors.grayscale.light1};\n      font-size: ${({ theme }) => 4 * theme.typography.sizes.s};\n    }\n  }\n  .no-show {\n    display: none;\n  }\n  .vertical-text {\n    writing-mode: vertical-rl;\n    text-orientation: mixed;\n  }\n  .sidebar {\n    height: 100%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n    width: ${({ theme }) => 8 * theme.gridUnit}px;\n  }\n  .callpase-icon > svg {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst getWindowSize = () => ({\n  height: window.innerHeight,\n  width: window.innerWidth,\n});\n\nfunction useWindowSize({ delayMs = 250 } = {}) {\n  const [size, setSize] = useState(getWindowSize());\n\n  useEffect(() => {\n    const onWindowResize = debounce(() => setSize(getWindowSize()), delayMs);\n    window.addEventListener('resize', onWindowResize);\n    return () => window.removeEventListener('resize', onWindowResize);\n  }, []);\n\n  return size;\n}\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = useDynamicPluginContext();\n  const dynamicPlugin = dynamicPluginContext.plugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.loading;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  const previousControls = usePrevious(props.controls);\n  const windowSize = useWindowSize();\n\n  const [showingModal, setShowingModal] = useState(false);\n  const [chartIsStale, setChartIsStale] = useState(false);\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const width = `${windowSize.width}px`;\n  const navHeight = props.standalone ? 0 : 90;\n  const height = props.forcedHeight\n    ? `${props.forcedHeight}px`\n    : `${windowSize.height - navHeight}px`;\n\n  const storageKeys = {\n    controlsWidth: 'controls_width',\n    dataSourceWidth: 'datasource_width',\n  };\n\n  const defaultSidebarsWidth = {\n    controls_width: 320,\n    datasource_width: 300,\n  };\n\n  function addHistory({ isReplace = false, title } = {}) {\n    const payload = { ...props.form_data };\n    const longUrl = getExploreLongUrl(\n      props.form_data,\n      props.standalone ? 'standalone' : null,\n      false,\n    );\n    try {\n      if (isReplace) {\n        window.history.replaceState(payload, title, longUrl);\n      } else {\n        window.history.pushState(payload, title, longUrl);\n      }\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        'Failed at altering browser history',\n        payload,\n        title,\n        longUrl,\n      );\n    }\n  }\n\n  function handlePopstate() {\n    const formData = window.history.state;\n    if (formData && Object.keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n        formData,\n        false,\n        props.timeout,\n        props.chart.id,\n      );\n    }\n  }\n\n  function onQuery() {\n    // remove alerts when query\n    props.actions.removeControlPanelAlert();\n    props.actions.triggerQuery(true, props.chart.id);\n\n    setChartIsStale(false);\n    addHistory();\n  }\n\n  function handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand) {\n      const isEnter = event.key === 'Enter' || event.keyCode === 13;\n      const isS = event.key === 's' || event.keyCode === 83;\n      if (isEnter) {\n        onQuery();\n      } else if (isS) {\n        if (props.slice) {\n          props.actions\n            .saveSlice(props.form_data, {\n              action: 'overwrite',\n              slice_id: props.slice.slice_id,\n              slice_name: props.slice.slice_name,\n              add_to_dash: 'noSave',\n              goto_dash: false,\n            })\n            .then(({ data }) => {\n              window.location = data.slice.slice_url;\n            });\n        }\n      }\n    }\n  }\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleModal() {\n    setShowingModal(!showingModal);\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  // effect to run on mount\n  useEffect(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n    addHistory({ isReplace: true });\n    window.addEventListener('popstate', handlePopstate);\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {\n    const hasError = Object.values(props.controls).some(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (previousControls) {\n      if (props.controls.viz_type.value !== previousControls.viz_type.value) {\n        props.actions.resetControls();\n      }\n      if (\n        props.controls.datasource &&\n        (previousControls.datasource == null ||\n          props.controls.datasource.value !== previousControls.datasource.value)\n      ) {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof previousControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            previousControls[key].value,\n          ),\n      );\n\n      // this should also be handled by the actions that are actually changing the controls\n      const hasDisplayControlChanged = changedControlKeys.some(\n        key => props.controls[key].renderTrigger,\n      );\n      if (hasDisplayControlChanged) {\n        props.actions.updateQueryFormData(\n          getFormDataFromControls(props.controls),\n          props.chart.id,\n        );\n        props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n        addHistory();\n      }\n\n      // this should be handled inside actions too\n      const hasQueryControlChanged = changedControlKeys.some(\n        key =>\n          !props.controls[key].renderTrigger &&\n          !props.controls[key].dontRefreshOnChange,\n      );\n      if (hasQueryControlChanged) {\n        props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n        setChartIsStale(true);\n      }\n    }\n  }, [props.controls]);\n\n  function renderErrorMessage() {\n    // Returns an error message as a node if any errors are in the store\n    const errors = Object.entries(props.controls)\n      .filter(\n        ([, control]) =>\n          control.validationErrors && control.validationErrors.length > 0,\n      )\n      .map(([key, control]) => (\n        <div key={key}>\n          {t('Control labeled ')}\n          <strong>{` \"${control.label}\" `}</strong>\n          {control.validationErrors.join('. ')}\n        </div>\n      ));\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = <div style={{ textAlign: 'left' }}>{errors}</div>;\n    }\n    return errorMessage;\n  }\n\n  function renderChartContainer() {\n    return (\n      <ExploreChartPanel\n        width={width}\n        height={height}\n        {...props}\n        errorMessage={renderErrorMessage()}\n        refreshOverlayVisible={chartIsStale}\n        addHistory={addHistory}\n        onQuery={onQuery}\n      />\n    );\n  }\n\n  function getSidebarWidths(key) {\n    try {\n      return localStorage.getItem(key) || defaultSidebarsWidth[key];\n    } catch {\n      return defaultSidebarsWidth[key];\n    }\n  }\n\n  function setSidebarWidths(key, dimension) {\n    try {\n      const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n      localStorage.setItem(key, newDimension);\n    } catch {\n      // Catch in case localStorage is unavailable\n    }\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    <Styles id=\"explore-container\" height={height}>\n      <Global\n        styles={css`\n          .navbar {\n            margin-bottom: 0;\n          }\n          body {\n            max-height: 100vh;\n            overflow: hidden;\n          }\n          #app-menu,\n          #app {\n            flex: 1 1 auto;\n          }\n          #app {\n            flex-basis: 100%;\n            overflow: hidden;\n            height: 100vh;\n          }\n          #app-menu {\n            flex-shrink: 0;\n          }\n        `}\n      />\n      {showingModal && (\n        <SaveModal\n          onHide={toggleModal}\n          actions={props.actions}\n          form_data={props.form_data}\n          sliceName={props.sliceName}\n          dashboardId={props.dashboardId}\n        />\n      )}\n      <Resizable\n        onResizeStop={(evt, direction, ref, d) =>\n          setSidebarWidths(storageKeys.dataSourceWidth, d)\n        }\n        defaultSize={{\n          width: getSidebarWidths(storageKeys.dataSourceWidth),\n          height: '100%',\n        }}\n        minWidth={defaultSidebarsWidth[storageKeys.dataSourceWidth]}\n        maxWidth=\"33%\"\n        enable={{ right: true }}\n        className={\n          isCollapsed ? 'no-show' : 'explore-column data-source-selection'\n        }\n      >\n        <div className=\"title-container\">\n          <span className=\"horizont al-text\">{t('Dataset')}</span>\n          <span\n            role=\"button\"\n            tabIndex={0}\n            className=\"action-button\"\n            onClick={toggleCollapse}\n          >\n            <Icon\n              name=\"expand\"\n              color={supersetTheme.colors.primary.base}\n              className=\"collapse-icon\"\n              width={16}\n            />\n          </span>\n        </div>\n        <DataSourcePanel\n          datasource={props.datasource}\n          controls={props.controls}\n          actions={props.actions}\n        />\n      </Resizable>\n      {isCollapsed ? (\n        <div\n          className=\"sidebar\"\n          onClick={toggleCollapse}\n          data-test=\"open-datasource-tab\"\n          role=\"button\"\n          tabIndex={0}\n        >\n          <span role=\"button\" tabIndex={0} className=\"action-button\">\n            <Tooltip title={t('Open Datasource tab')}>\n              <Icon\n                name=\"collapse\"\n                color={supersetTheme.colors.primary.base}\n                className=\"collapse-icon\"\n                width={16}\n              />\n            </Tooltip>\n          </span>\n          <Icon name=\"dataset-physical\" width={16} />\n        </div>\n      ) : null}\n      <Resizable\n        onResizeStop={(evt, direction, ref, d) =>\n          setSidebarWidths(storageKeys.controlsWidth, d)\n        }\n        defaultSize={{\n          width: getSidebarWidths(storageKeys.controlsWidth),\n          height: '100%',\n        }}\n        minWidth={defaultSidebarsWidth[storageKeys.controlsWidth]}\n        maxWidth=\"33%\"\n        enable={{ right: true }}\n        className=\"col-sm-3 explore-column controls-column\"\n      >\n        <QueryAndSaveBtns\n          canAdd={!!(props.can_add || props.can_overwrite)}\n          onQuery={onQuery}\n          onSave={toggleModal}\n          onStop={onStop}\n          loading={props.chart.chartStatus === 'loading'}\n          chartIsStale={chartIsStale}\n          errorMessage={renderErrorMessage()}\n          datasourceType={props.datasource_type}\n        />\n        <ConnectedControlPanelsContainer\n          actions={props.actions}\n          form_data={props.form_data}\n          controls={props.controls}\n          datasource_type={props.datasource_type}\n          isDatasourceMetaLoading={props.isDatasourceMetaLoading}\n        />\n      </Resizable>\n      <div\n        className={`main-explore-content ${\n          isCollapsed ? 'col-sm-9' : 'col-sm-7'\n        }`}\n      >\n        {renderChartContainer()}\n      </div>\n    </Styles>\n  );\n}\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {\n  const { explore, charts, impressionId } = state;\n  const form_data = getFormDataFromControls(explore.controls);\n  const chartKey = Object.keys(charts)[0];\n  const chart = charts[chartKey];\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource: explore.datasource,\n    datasource_type: explore.datasource.type,\n    datasourceId: explore.datasource_id,\n    dashboardId: explore.form_data ? explore.form_data.dashboardId : undefined,\n    controls: explore.controls,\n    can_overwrite: !!explore.can_overwrite,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    column_formats: explore.datasource\n      ? explore.datasource.column_formats\n      : null,\n    containerId: explore.slice\n      ? `slice-container-${explore.slice.slice_id}`\n      : 'slice-container',\n    isStarred: explore.isStarred,\n    slice: explore.slice,\n    sliceName: explore.sliceName,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: form_data.datasource_name,\n    vizType: form_data.viz_type,\n    standalone: explore.standalone,\n    forcedHeight: explore.forced_height,\n    chart,\n    timeout: explore.common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    impressionId,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions,\n  };\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(ExploreViewContainer);\n"]},"metadata":{},"sourceType":"module"}