{"ast":null,"code":"import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _flatMapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/flat-map\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport Popover from 'src/common/components/Popover';\nimport Icon from 'src/components/Icon';\nimport { Pill } from 'src/dashboard/components/FiltersBadge/Styles';\nimport { CascadeFilterControl, FilterControl } from './FilterBar';import { jsx as ___EmotionJSX } from \"@emotion/core\";\nconst StyledTitleBox = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  background-color: ${({ theme }) => theme.colors.grayscale.light4};\n  margin: ${({ theme }) => theme.gridUnit * -1}px\n    ${({ theme }) => theme.gridUnit * -4}px; // to override default antd padding\n  padding: ${({ theme }) => theme.gridUnit * 2}px\n    ${({ theme }) => theme.gridUnit * 4}px;\n\n  & > *:last-child {\n    cursor: pointer;\n  }\n`;\nconst StyledTitle = styled.h4`\n  display: flex;\n  align-items: center;\n  color: ${({ theme }) => theme.colors.grayscale.dark1};\n  margin: 0;\n  padding: 0;\n`;\nconst StyledIcon = styled(Icon)`\n  margin-right: ${({ theme }) => theme.gridUnit}px;\n  color: ${({ theme }) => theme.colors.grayscale.dark1};\n  width: ${({ theme }) => theme.gridUnit * 4}px;\n`;\nconst StyledPill = styled(Pill)`\n  padding: ${({ theme }) => theme.gridUnit}px\n    ${({ theme }) => theme.gridUnit * 2}px;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  background: ${({ theme }) => theme.colors.grayscale.light1};\n`;\nconst CascadePopover = ({ filter, visible, onVisibleChange, onExtraFormDataChange }) => {var _filter$cascadeChildr;\n  const getActiveChildren = useCallback(filter => {\n    const children = filter.cascadeChildren || [];\n    const currentValue = filter.currentValue || [];\n    const activeChildren = _flatMapInstanceProperty(children).call(children, childFilter => getActiveChildren(childFilter) || []);\n    if (activeChildren.length > 0) {\n      return activeChildren;\n    }\n    if (currentValue.length > 0) {\n      return [filter];\n    }\n    return null;\n  }, []);\n  if (!((_filter$cascadeChildr = filter.cascadeChildren) != null && _filter$cascadeChildr.length)) {\n    return ___EmotionJSX(FilterControl, { filter: filter, onExtraFormDataChange: onExtraFormDataChange });\n  }\n  const countFilters = filter => {var _context;\n    let count = 1;\n    _forEachInstanceProperty(_context = filter.cascadeChildren).call(_context, child => {\n      count += countFilters(child);\n    });\n    return count;\n  };\n  const totalChildren = countFilters(filter);\n  const title = ___EmotionJSX(StyledTitleBox, null,\n  ___EmotionJSX(StyledTitle, null,\n  ___EmotionJSX(StyledIcon, { name: \"edit\" }),\n  t('Select parent filters'), \" (\", totalChildren, \")\"),\n\n  ___EmotionJSX(StyledIcon, { name: \"close\", onClick: () => onVisibleChange(false) }));\n\n  const content = ___EmotionJSX(CascadeFilterControl, { \"data-test\": \"cascade-filters-control\", key: filter.id, filter: filter, onExtraFormDataChange: onExtraFormDataChange });\n  const activeFilters = getActiveChildren(filter) || [filter];\n  return ___EmotionJSX(Popover, { content: content, title: title, trigger: \"click\", visible: visible, onVisibleChange: onVisibleChange, placement: \"rightTop\", id: filter.id, overlayStyle: { minWidth: '400px', maxWidth: '600px' } },\n  ___EmotionJSX(\"div\", null,\n  _mapInstanceProperty(activeFilters).call(activeFilters, activeFilter => ___EmotionJSX(FilterControl, { key: activeFilter.id, filter: activeFilter, onExtraFormDataChange: onExtraFormDataChange, icon: ___EmotionJSX(React.Fragment, null,\n    filter.cascadeChildren.length !== 0 && ___EmotionJSX(StyledPill, { onClick: () => onVisibleChange(true) },\n    ___EmotionJSX(Icon, { name: \"filter\" }), \" \", totalChildren)) }))));\n\n\n\n\n};__signature__(CascadePopover, \"useCallback{getActiveChildren}\");const _default =\nCascadePopover;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(StyledTitleBox, \"StyledTitleBox\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/CascadePopover.tsx\");reactHotLoader.register(StyledTitle, \"StyledTitle\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/CascadePopover.tsx\");reactHotLoader.register(StyledIcon, \"StyledIcon\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/CascadePopover.tsx\");reactHotLoader.register(StyledPill, \"StyledPill\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/CascadePopover.tsx\");reactHotLoader.register(CascadePopover, \"CascadePopover\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/CascadePopover.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/CascadePopover.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/dashboard/components/nativeFilters/CascadePopover.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback } from 'react';\nimport { ExtraFormData, styled, t } from '@superset-ui/core';\nimport Popover from 'src/common/components/Popover';\nimport Icon from 'src/components/Icon';\nimport { Pill } from 'src/dashboard/components/FiltersBadge/Styles';\nimport { CascadeFilterControl, FilterControl } from './FilterBar';\nimport { Filter, CascadeFilter } from './types';\n\ninterface CascadePopoverProps {\n  filter: CascadeFilter;\n  visible: boolean;\n  onVisibleChange: (visible: boolean) => void;\n  onExtraFormDataChange: (filter: Filter, extraFormData: ExtraFormData) => void;\n}\n\nconst StyledTitleBox = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  background-color: ${({ theme }) => theme.colors.grayscale.light4};\n  margin: ${({ theme }) => theme.gridUnit * -1}px\n    ${({ theme }) => theme.gridUnit * -4}px; // to override default antd padding\n  padding: ${({ theme }) => theme.gridUnit * 2}px\n    ${({ theme }) => theme.gridUnit * 4}px;\n\n  & > *:last-child {\n    cursor: pointer;\n  }\n`;\n\nconst StyledTitle = styled.h4`\n  display: flex;\n  align-items: center;\n  color: ${({ theme }) => theme.colors.grayscale.dark1};\n  margin: 0;\n  padding: 0;\n`;\n\nconst StyledIcon = styled(Icon)`\n  margin-right: ${({ theme }) => theme.gridUnit}px;\n  color: ${({ theme }) => theme.colors.grayscale.dark1};\n  width: ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\nconst StyledPill = styled(Pill)`\n  padding: ${({ theme }) => theme.gridUnit}px\n    ${({ theme }) => theme.gridUnit * 2}px;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  background: ${({ theme }) => theme.colors.grayscale.light1};\n`;\n\nconst CascadePopover: React.FC<CascadePopoverProps> = ({\n  filter,\n  visible,\n  onVisibleChange,\n  onExtraFormDataChange,\n}) => {\n  const getActiveChildren = useCallback((filter: CascadeFilter):\n    | CascadeFilter[]\n    | null => {\n    const children = filter.cascadeChildren || [];\n    const currentValue = filter.currentValue || [];\n\n    const activeChildren = children.flatMap(\n      childFilter => getActiveChildren(childFilter) || [],\n    );\n\n    if (activeChildren.length > 0) {\n      return activeChildren;\n    }\n\n    if (currentValue.length > 0) {\n      return [filter];\n    }\n\n    return null;\n  }, []);\n\n  if (!filter.cascadeChildren?.length) {\n    return (\n      <FilterControl\n        filter={filter}\n        onExtraFormDataChange={onExtraFormDataChange}\n      />\n    );\n  }\n\n  const countFilters = (filter: CascadeFilter): number => {\n    let count = 1;\n    filter.cascadeChildren.forEach(child => {\n      count += countFilters(child);\n    });\n    return count;\n  };\n\n  const totalChildren = countFilters(filter);\n\n  const title = (\n    <StyledTitleBox>\n      <StyledTitle>\n        <StyledIcon name=\"edit\" />\n        {t('Select parent filters')} ({totalChildren})\n      </StyledTitle>\n      <StyledIcon name=\"close\" onClick={() => onVisibleChange(false)} />\n    </StyledTitleBox>\n  );\n\n  const content = (\n    <CascadeFilterControl\n      data-test=\"cascade-filters-control\"\n      key={filter.id}\n      filter={filter}\n      onExtraFormDataChange={onExtraFormDataChange}\n    />\n  );\n\n  const activeFilters = getActiveChildren(filter) || [filter];\n\n  return (\n    <Popover\n      content={content}\n      title={title}\n      trigger=\"click\"\n      visible={visible}\n      onVisibleChange={onVisibleChange}\n      placement=\"rightTop\"\n      id={filter.id}\n      overlayStyle={{ minWidth: '400px', maxWidth: '600px' }}\n    >\n      <div>\n        {activeFilters.map(activeFilter => (\n          <FilterControl\n            key={activeFilter.id}\n            filter={activeFilter}\n            onExtraFormDataChange={onExtraFormDataChange}\n            icon={\n              <>\n                {filter.cascadeChildren.length !== 0 && (\n                  <StyledPill onClick={() => onVisibleChange(true)}>\n                    <Icon name=\"filter\" /> {totalChildren}\n                  </StyledPill>\n                )}\n              </>\n            }\n          />\n        ))}\n      </div>\n    </Popover>\n  );\n};\n\nexport default CascadePopover;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}