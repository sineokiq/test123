{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { styled, t } from '@superset-ui/core';\nimport { Menu, NoAnimationDropdown } from 'src/common/components';\nimport URLShortLinkModal from '../../components/URLShortLinkModal';\nimport downloadAsImage from '../../utils/downloadAsImage';\nimport getDashboardUrl from '../util/getDashboardUrl';\nimport { getActiveFilters } from '../util/activeDashboardFilters';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  slice: PropTypes.object.isRequired,\n  componentId: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number.isRequired,\n  addDangerToast: PropTypes.func.isRequired,\n  isCached: PropTypes.arrayOf(PropTypes.bool),\n  cachedDttm: PropTypes.arrayOf(PropTypes.string),\n  isExpanded: PropTypes.bool,\n  updatedDttm: PropTypes.number,\n  supersetCanExplore: PropTypes.bool,\n  supersetCanCSV: PropTypes.bool,\n  sliceCanEdit: PropTypes.bool,\n  toggleExpandSlice: PropTypes.func,\n  forceRefresh: PropTypes.func,\n  exploreChart: PropTypes.func,\n  exportCSV: PropTypes.func };\n\n\nconst defaultProps = {\n  forceRefresh: () => ({}),\n  toggleExpandSlice: () => ({}),\n  exploreChart: () => ({}),\n  exportCSV: () => ({}),\n  cachedDttm: [],\n  updatedDttm: null,\n  isCached: [],\n  isExpanded: false,\n  supersetCanExplore: false,\n  supersetCanCSV: false,\n  sliceCanEdit: false };\n\n\nconst MENU_KEYS = {\n  FORCE_REFRESH: 'force_refresh',\n  TOGGLE_CHART_DESCRIPTION: 'toggle_chart_description',\n  EXPLORE_CHART: 'explore_chart',\n  EXPORT_CSV: 'export_csv',\n  RESIZE_LABEL: 'resize_label',\n  SHARE_CHART: 'share_chart',\n  DOWNLOAD_AS_IMAGE: 'download_as_image' };\n\n\nconst VerticalDotsContainer = styled.div`\n  padding: ${({ theme }) => theme.gridUnit / 4}px\n    ${({ theme }) => theme.gridUnit * 1.5}px;\n\n  .dot {\n    display: block;\n  }\n\n  &:hover {\n    cursor: pointer;\n  }\n`;\n\nconst RefreshTooltip = styled.div`\n  height: auto;\n  margin: ${({ theme }) => theme.gridUnit}px 0;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n  line-height: ${({ theme }) => theme.typography.sizes.m * 1.5}px;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  justify-content: flex-start;\n`;\n\nconst SCREENSHOT_NODE_SELECTOR = '.dashboard-component-chart-holder';\n\nconst VerticalDotsTrigger = () =>\n___EmotionJSX(VerticalDotsContainer, null,\n___EmotionJSX(\"span\", { className: \"dot\" }),\n___EmotionJSX(\"span\", { className: \"dot\" }),\n___EmotionJSX(\"span\", { className: \"dot\" }));\n\n\n\nclass SliceHeaderControls extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3;\n    super(props);\n    this.toggleControls = _bindInstanceProperty(_context = this.toggleControls).call(_context, this);\n    this.refreshChart = _bindInstanceProperty(_context2 = this.refreshChart).call(_context2, this);\n    this.handleMenuClick = _bindInstanceProperty(_context3 = this.handleMenuClick).call(_context3, this);\n\n    this.state = {\n      showControls: false };\n\n  }\n\n  refreshChart() {\n    if (this.props.updatedDttm) {\n      this.props.forceRefresh(\n      _sliceInstanceProperty(this.props).slice_id,\n      this.props.dashboardId);\n\n    }\n  }\n\n  toggleControls() {\n    this.setState(prevState => ({\n      showControls: !prevState.showControls }));\n\n  }\n\n  handleMenuClick({ key, domEvent }) {\n    switch (key) {\n      case MENU_KEYS.FORCE_REFRESH:\n        this.refreshChart();\n        break;\n      case MENU_KEYS.TOGGLE_CHART_DESCRIPTION:\n        this.props.toggleExpandSlice(_sliceInstanceProperty(this.props).slice_id);\n        break;\n      case MENU_KEYS.EXPLORE_CHART:\n        this.props.exploreChart(_sliceInstanceProperty(this.props).slice_id);\n        break;\n      case MENU_KEYS.EXPORT_CSV:\n        this.props.exportCSV(_sliceInstanceProperty(this.props).slice_id);\n        break;\n      case MENU_KEYS.RESIZE_LABEL:\n        this.props.handleToggleFullSize();\n        break;\n      case MENU_KEYS.DOWNLOAD_AS_IMAGE:{\n          // menu closes with a delay, we need to hide it manually,\n          // so that we don't capture it on the screenshot\n          const menu = document.querySelector(\n          '.ant-dropdown:not(.ant-dropdown-hidden)');\n\n          menu.style.visibility = 'hidden';\n          downloadAsImage(\n          SCREENSHOT_NODE_SELECTOR,\n          _sliceInstanceProperty(this.props).slice_name)(\n          domEvent).then(() => {\n            menu.style.visibility = 'visible';\n          });\n          break;\n        }\n      default:\n        break;}\n\n  }\n\n  render() {\n    const {\n      slice,\n      isCached,\n      cachedDttm,\n      updatedDttm,\n      componentId,\n      addDangerToast,\n      isFullSize } =\n    this.props;\n    const cachedWhen = _mapInstanceProperty(cachedDttm).call(cachedDttm, (itemCachedDttm) =>\n    moment.utc(itemCachedDttm).fromNow());\n\n    const updatedWhen = updatedDttm ? moment.utc(updatedDttm).fromNow() : '';\n    const getCachedTitle = itemCached => {\n      if (itemCached) {\n        return t('Cached %s', cachedWhen);\n      }\n      if (updatedWhen) {\n        return t('Fetched %s', updatedWhen);\n      }\n      return '';\n    };\n    const refreshTooltipData = _mapInstanceProperty(isCached).call(isCached, getCachedTitle) || '';\n    // If all queries have same cache time we can unit them to one\n    let refreshTooltip = [...new _Set(refreshTooltipData)];\n    refreshTooltip = _mapInstanceProperty(refreshTooltip).call(refreshTooltip, (item, index) =>\n    ___EmotionJSX(\"div\", null,\n    refreshTooltip.length > 1 ?\n    `${t('Query')} ${index + 1}: ${item}` :\n    item));\n\n\n    const resizeLabel = isFullSize ? t('Minimize chart') : t('Maximize chart');\n    const menu =\n    ___EmotionJSX(Menu, {\n      onClick: this.handleMenuClick,\n      selectable: false,\n      \"data-test\": `slice_${slice.slice_id}-menu` },\n\n    ___EmotionJSX(Menu.Item, {\n      key: MENU_KEYS.FORCE_REFRESH,\n      disabled: this.props.chartStatus === 'loading',\n      style: { height: 'auto', lineHeight: 'initial' },\n      \"data-test\": \"refresh-chart-menu-item\" },\n\n    t('Force refresh'),\n    ___EmotionJSX(RefreshTooltip, { \"data-test\": \"dashboard-slice-refresh-tooltip\" },\n    refreshTooltip)),\n\n\n\n    ___EmotionJSX(Menu.Divider, null),\n\n    slice.description &&\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.TOGGLE_CHART_DESCRIPTION },\n    t('Toggle chart description')),\n\n\n\n    this.props.supersetCanExplore &&\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.EXPLORE_CHART },\n    t('View chart in Explore')),\n\n\n\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.SHARE_CHART },\n    ___EmotionJSX(URLShortLinkModal, {\n      url: getDashboardUrl(\n      window.location.pathname,\n      getActiveFilters(),\n      componentId),\n\n      addDangerToast: addDangerToast,\n      title: t('Share chart'),\n      triggerNode: ___EmotionJSX(\"span\", null, t('Share chart')) })),\n\n\n\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.RESIZE_LABEL }, resizeLabel),\n\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.DOWNLOAD_AS_IMAGE },\n    t('Download as image')),\n\n\n    this.props.supersetCanCSV &&\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.EXPORT_CSV }, t('Export CSV')));\n\n\n\n\n    return (\n      ___EmotionJSX(NoAnimationDropdown, {\n        overlay: menu,\n        trigger: ['click'],\n        placement: \"bottomRight\",\n        dropdownAlign: {\n          offset: [-40, 4] },\n\n        getPopupContainer: (triggerNode) =>\n        triggerNode.closest(SCREENSHOT_NODE_SELECTOR) },\n\n\n      ___EmotionJSX(\"span\", { id: `slice_${slice.slice_id}-controls`, role: \"button\" },\n      ___EmotionJSX(VerticalDotsTrigger, null))));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nSliceHeaderControls.propTypes = propTypes;\nSliceHeaderControls.defaultProps = defaultProps;const _default =\n\nSliceHeaderControls;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/dashboard/components/SliceHeaderControls.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/app/superset-frontend/src/dashboard/components/SliceHeaderControls.jsx\");reactHotLoader.register(MENU_KEYS, \"MENU_KEYS\", \"/app/superset-frontend/src/dashboard/components/SliceHeaderControls.jsx\");reactHotLoader.register(VerticalDotsContainer, \"VerticalDotsContainer\", \"/app/superset-frontend/src/dashboard/components/SliceHeaderControls.jsx\");reactHotLoader.register(RefreshTooltip, \"RefreshTooltip\", \"/app/superset-frontend/src/dashboard/components/SliceHeaderControls.jsx\");reactHotLoader.register(SCREENSHOT_NODE_SELECTOR, \"SCREENSHOT_NODE_SELECTOR\", \"/app/superset-frontend/src/dashboard/components/SliceHeaderControls.jsx\");reactHotLoader.register(VerticalDotsTrigger, \"VerticalDotsTrigger\", \"/app/superset-frontend/src/dashboard/components/SliceHeaderControls.jsx\");reactHotLoader.register(SliceHeaderControls, \"SliceHeaderControls\", \"/app/superset-frontend/src/dashboard/components/SliceHeaderControls.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/dashboard/components/SliceHeaderControls.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/dashboard/components/SliceHeaderControls.jsx"],"names":["React","PropTypes","moment","styled","t","Menu","NoAnimationDropdown","URLShortLinkModal","downloadAsImage","getDashboardUrl","getActiveFilters","propTypes","slice","object","isRequired","componentId","string","dashboardId","number","addDangerToast","func","isCached","arrayOf","bool","cachedDttm","isExpanded","updatedDttm","supersetCanExplore","supersetCanCSV","sliceCanEdit","toggleExpandSlice","forceRefresh","exploreChart","exportCSV","defaultProps","MENU_KEYS","FORCE_REFRESH","TOGGLE_CHART_DESCRIPTION","EXPLORE_CHART","EXPORT_CSV","RESIZE_LABEL","SHARE_CHART","DOWNLOAD_AS_IMAGE","VerticalDotsContainer","div","theme","gridUnit","RefreshTooltip","colors","grayscale","base","typography","sizes","m","SCREENSHOT_NODE_SELECTOR","VerticalDotsTrigger","SliceHeaderControls","PureComponent","constructor","props","toggleControls","refreshChart","handleMenuClick","state","showControls","slice_id","setState","prevState","key","domEvent","handleToggleFullSize","menu","document","querySelector","style","visibility","slice_name","then","render","isFullSize","cachedWhen","itemCachedDttm","utc","fromNow","updatedWhen","getCachedTitle","itemCached","refreshTooltipData","refreshTooltip","item","index","length","resizeLabel","chartStatus","height","lineHeight","description","window","location","pathname","offset","triggerNode","closest"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { styled, t } from '@superset-ui/core';\nimport { Menu, NoAnimationDropdown } from 'src/common/components';\nimport URLShortLinkModal from '../../components/URLShortLinkModal';\nimport downloadAsImage from '../../utils/downloadAsImage';\nimport getDashboardUrl from '../util/getDashboardUrl';\nimport { getActiveFilters } from '../util/activeDashboardFilters';\n\nconst propTypes = {\n  slice: PropTypes.object.isRequired,\n  componentId: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number.isRequired,\n  addDangerToast: PropTypes.func.isRequired,\n  isCached: PropTypes.arrayOf(PropTypes.bool),\n  cachedDttm: PropTypes.arrayOf(PropTypes.string),\n  isExpanded: PropTypes.bool,\n  updatedDttm: PropTypes.number,\n  supersetCanExplore: PropTypes.bool,\n  supersetCanCSV: PropTypes.bool,\n  sliceCanEdit: PropTypes.bool,\n  toggleExpandSlice: PropTypes.func,\n  forceRefresh: PropTypes.func,\n  exploreChart: PropTypes.func,\n  exportCSV: PropTypes.func,\n};\n\nconst defaultProps = {\n  forceRefresh: () => ({}),\n  toggleExpandSlice: () => ({}),\n  exploreChart: () => ({}),\n  exportCSV: () => ({}),\n  cachedDttm: [],\n  updatedDttm: null,\n  isCached: [],\n  isExpanded: false,\n  supersetCanExplore: false,\n  supersetCanCSV: false,\n  sliceCanEdit: false,\n};\n\nconst MENU_KEYS = {\n  FORCE_REFRESH: 'force_refresh',\n  TOGGLE_CHART_DESCRIPTION: 'toggle_chart_description',\n  EXPLORE_CHART: 'explore_chart',\n  EXPORT_CSV: 'export_csv',\n  RESIZE_LABEL: 'resize_label',\n  SHARE_CHART: 'share_chart',\n  DOWNLOAD_AS_IMAGE: 'download_as_image',\n};\n\nconst VerticalDotsContainer = styled.div`\n  padding: ${({ theme }) => theme.gridUnit / 4}px\n    ${({ theme }) => theme.gridUnit * 1.5}px;\n\n  .dot {\n    display: block;\n  }\n\n  &:hover {\n    cursor: pointer;\n  }\n`;\n\nconst RefreshTooltip = styled.div`\n  height: auto;\n  margin: ${({ theme }) => theme.gridUnit}px 0;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n  line-height: ${({ theme }) => theme.typography.sizes.m * 1.5}px;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  justify-content: flex-start;\n`;\n\nconst SCREENSHOT_NODE_SELECTOR = '.dashboard-component-chart-holder';\n\nconst VerticalDotsTrigger = () => (\n  <VerticalDotsContainer>\n    <span className=\"dot\" />\n    <span className=\"dot\" />\n    <span className=\"dot\" />\n  </VerticalDotsContainer>\n);\n\nclass SliceHeaderControls extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.toggleControls = this.toggleControls.bind(this);\n    this.refreshChart = this.refreshChart.bind(this);\n    this.handleMenuClick = this.handleMenuClick.bind(this);\n\n    this.state = {\n      showControls: false,\n    };\n  }\n\n  refreshChart() {\n    if (this.props.updatedDttm) {\n      this.props.forceRefresh(\n        this.props.slice.slice_id,\n        this.props.dashboardId,\n      );\n    }\n  }\n\n  toggleControls() {\n    this.setState(prevState => ({\n      showControls: !prevState.showControls,\n    }));\n  }\n\n  handleMenuClick({ key, domEvent }) {\n    switch (key) {\n      case MENU_KEYS.FORCE_REFRESH:\n        this.refreshChart();\n        break;\n      case MENU_KEYS.TOGGLE_CHART_DESCRIPTION:\n        this.props.toggleExpandSlice(this.props.slice.slice_id);\n        break;\n      case MENU_KEYS.EXPLORE_CHART:\n        this.props.exploreChart(this.props.slice.slice_id);\n        break;\n      case MENU_KEYS.EXPORT_CSV:\n        this.props.exportCSV(this.props.slice.slice_id);\n        break;\n      case MENU_KEYS.RESIZE_LABEL:\n        this.props.handleToggleFullSize();\n        break;\n      case MENU_KEYS.DOWNLOAD_AS_IMAGE: {\n        // menu closes with a delay, we need to hide it manually,\n        // so that we don't capture it on the screenshot\n        const menu = document.querySelector(\n          '.ant-dropdown:not(.ant-dropdown-hidden)',\n        );\n        menu.style.visibility = 'hidden';\n        downloadAsImage(\n          SCREENSHOT_NODE_SELECTOR,\n          this.props.slice.slice_name,\n        )(domEvent).then(() => {\n          menu.style.visibility = 'visible';\n        });\n        break;\n      }\n      default:\n        break;\n    }\n  }\n\n  render() {\n    const {\n      slice,\n      isCached,\n      cachedDttm,\n      updatedDttm,\n      componentId,\n      addDangerToast,\n      isFullSize,\n    } = this.props;\n    const cachedWhen = cachedDttm.map(itemCachedDttm =>\n      moment.utc(itemCachedDttm).fromNow(),\n    );\n    const updatedWhen = updatedDttm ? moment.utc(updatedDttm).fromNow() : '';\n    const getCachedTitle = itemCached => {\n      if (itemCached) {\n        return t('Cached %s', cachedWhen);\n      }\n      if (updatedWhen) {\n        return t('Fetched %s', updatedWhen);\n      }\n      return '';\n    };\n    const refreshTooltipData = isCached.map(getCachedTitle) || '';\n    // If all queries have same cache time we can unit them to one\n    let refreshTooltip = [...new Set(refreshTooltipData)];\n    refreshTooltip = refreshTooltip.map((item, index) => (\n      <div>\n        {refreshTooltip.length > 1\n          ? `${t('Query')} ${index + 1}: ${item}`\n          : item}\n      </div>\n    ));\n    const resizeLabel = isFullSize ? t('Minimize chart') : t('Maximize chart');\n    const menu = (\n      <Menu\n        onClick={this.handleMenuClick}\n        selectable={false}\n        data-test={`slice_${slice.slice_id}-menu`}\n      >\n        <Menu.Item\n          key={MENU_KEYS.FORCE_REFRESH}\n          disabled={this.props.chartStatus === 'loading'}\n          style={{ height: 'auto', lineHeight: 'initial' }}\n          data-test=\"refresh-chart-menu-item\"\n        >\n          {t('Force refresh')}\n          <RefreshTooltip data-test=\"dashboard-slice-refresh-tooltip\">\n            {refreshTooltip}\n          </RefreshTooltip>\n        </Menu.Item>\n\n        <Menu.Divider />\n\n        {slice.description && (\n          <Menu.Item key={MENU_KEYS.TOGGLE_CHART_DESCRIPTION}>\n            {t('Toggle chart description')}\n          </Menu.Item>\n        )}\n\n        {this.props.supersetCanExplore && (\n          <Menu.Item key={MENU_KEYS.EXPLORE_CHART}>\n            {t('View chart in Explore')}\n          </Menu.Item>\n        )}\n\n        <Menu.Item key={MENU_KEYS.SHARE_CHART}>\n          <URLShortLinkModal\n            url={getDashboardUrl(\n              window.location.pathname,\n              getActiveFilters(),\n              componentId,\n            )}\n            addDangerToast={addDangerToast}\n            title={t('Share chart')}\n            triggerNode={<span>{t('Share chart')}</span>}\n          />\n        </Menu.Item>\n\n        <Menu.Item key={MENU_KEYS.RESIZE_LABEL}>{resizeLabel}</Menu.Item>\n\n        <Menu.Item key={MENU_KEYS.DOWNLOAD_AS_IMAGE}>\n          {t('Download as image')}\n        </Menu.Item>\n\n        {this.props.supersetCanCSV && (\n          <Menu.Item key={MENU_KEYS.EXPORT_CSV}>{t('Export CSV')}</Menu.Item>\n        )}\n      </Menu>\n    );\n\n    return (\n      <NoAnimationDropdown\n        overlay={menu}\n        trigger={['click']}\n        placement=\"bottomRight\"\n        dropdownAlign={{\n          offset: [-40, 4],\n        }}\n        getPopupContainer={triggerNode =>\n          triggerNode.closest(SCREENSHOT_NODE_SELECTOR)\n        }\n      >\n        <span id={`slice_${slice.slice_id}-controls`} role=\"button\">\n          <VerticalDotsTrigger />\n        </span>\n      </NoAnimationDropdown>\n    );\n  }\n}\n\nSliceHeaderControls.propTypes = propTypes;\nSliceHeaderControls.defaultProps = defaultProps;\n\nexport default SliceHeaderControls;\n"]},"metadata":{},"sourceType":"module"}