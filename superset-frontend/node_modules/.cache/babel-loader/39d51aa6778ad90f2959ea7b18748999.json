{"ast":null,"code":"import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { styled, t, SupersetClient } from '@superset-ui/core';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport Omnibar from 'omnibar';\nimport Modal from 'src/common/components/Modal';\nimport { LOG_ACTIONS_OMNIBAR_TRIGGERED } from '../logger/LogUtils';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  logEvent: PropTypes.func.isRequired };\n\n\nconst getDashboards = (query) =>\n// todo: Build a dedicated endpoint for dashboard searching\n// i.e. superset/v1/api/dashboards?q=${query}\nSupersetClient.get({\n  endpoint: `/dashboardasync/api/read?_oc_DashboardModelViewAsync=changed_on&_od_DashboardModelViewAsync=desc&_flt_2_dashboard_title=${query}` }).\n\nthen(({ json }) => {var _context;return (\n    _mapInstanceProperty(_context = json.result).call(_context, item => ({\n      title: item.dashboard_title,\n      ...item })));}).\n\n\ncatch(() => ({\n  title: t('An error occurred while fetching dashboards') }));\n\n\nconst OmniModal = styled(Modal)`\n  margin-top: 20%;\n\n  .ant-modal-body {\n    padding: 0;\n  }\n`;\n\nclass OmniContainer extends React.Component {\n  constructor(props) {var _context2;\n    super(props);\n    this.state = {\n      showOmni: false };\n\n    this.handleKeydown = _bindInstanceProperty(_context2 = this.handleKeydown).call(_context2, this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeydown);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeydown);\n  }\n\n  handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand && isFeatureEnabled(FeatureFlag.OMNIBAR)) {\n      const isK = event.key === 'k' || event.keyCode === 83;\n      if (isK) {\n        this.props.logEvent(LOG_ACTIONS_OMNIBAR_TRIGGERED, {\n          show_omni: !this.state.showOmni });\n\n\n        this.setState(prevState => ({ showOmni: !prevState.showOmni }));\n\n        document.getElementsByClassName('Omnibar')[0].focus();\n      }\n    }\n  }\n\n  render() {\n    return (\n      ___EmotionJSX(OmniModal, { show: this.state.showOmni, hideFooter: true, closable: false },\n      ___EmotionJSX(Omnibar, {\n        className: \"Omnibar\",\n        placeholder: \"Search all dashboards\",\n        extensions: [getDashboards] })));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nOmniContainer.propTypes = propTypes;const _default =\nOmniContainer;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/components/OmniContainer.jsx\");reactHotLoader.register(getDashboards, \"getDashboards\", \"/app/superset-frontend/src/components/OmniContainer.jsx\");reactHotLoader.register(OmniModal, \"OmniModal\", \"/app/superset-frontend/src/components/OmniContainer.jsx\");reactHotLoader.register(OmniContainer, \"OmniContainer\", \"/app/superset-frontend/src/components/OmniContainer.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/components/OmniContainer.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/components/OmniContainer.jsx"],"names":["React","PropTypes","styled","t","SupersetClient","isFeatureEnabled","FeatureFlag","Omnibar","Modal","LOG_ACTIONS_OMNIBAR_TRIGGERED","propTypes","logEvent","func","isRequired","getDashboards","query","get","endpoint","then","json","result","item","title","dashboard_title","catch","OmniModal","OmniContainer","Component","constructor","props","state","showOmni","handleKeydown","componentDidMount","document","addEventListener","componentWillUnmount","removeEventListener","event","controlOrCommand","ctrlKey","metaKey","OMNIBAR","isK","key","keyCode","show_omni","setState","prevState","getElementsByClassName","focus","render"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { styled, t, SupersetClient } from '@superset-ui/core';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport Omnibar from 'omnibar';\nimport Modal from 'src/common/components/Modal';\nimport { LOG_ACTIONS_OMNIBAR_TRIGGERED } from '../logger/LogUtils';\n\nconst propTypes = {\n  logEvent: PropTypes.func.isRequired,\n};\n\nconst getDashboards = query =>\n  // todo: Build a dedicated endpoint for dashboard searching\n  // i.e. superset/v1/api/dashboards?q=${query}\n  SupersetClient.get({\n    endpoint: `/dashboardasync/api/read?_oc_DashboardModelViewAsync=changed_on&_od_DashboardModelViewAsync=desc&_flt_2_dashboard_title=${query}`,\n  })\n    .then(({ json }) =>\n      json.result.map(item => ({\n        title: item.dashboard_title,\n        ...item,\n      })),\n    )\n    .catch(() => ({\n      title: t('An error occurred while fetching dashboards'),\n    }));\n\nconst OmniModal = styled(Modal)`\n  margin-top: 20%;\n\n  .ant-modal-body {\n    padding: 0;\n  }\n`;\n\nclass OmniContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showOmni: false,\n    };\n    this.handleKeydown = this.handleKeydown.bind(this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeydown);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeydown);\n  }\n\n  handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand && isFeatureEnabled(FeatureFlag.OMNIBAR)) {\n      const isK = event.key === 'k' || event.keyCode === 83;\n      if (isK) {\n        this.props.logEvent(LOG_ACTIONS_OMNIBAR_TRIGGERED, {\n          show_omni: !this.state.showOmni,\n        });\n\n        this.setState(prevState => ({ showOmni: !prevState.showOmni }));\n\n        document.getElementsByClassName('Omnibar')[0].focus();\n      }\n    }\n  }\n\n  render() {\n    return (\n      <OmniModal show={this.state.showOmni} hideFooter closable={false}>\n        <Omnibar\n          className=\"Omnibar\"\n          placeholder=\"Search all dashboards\"\n          extensions={[getDashboards]}\n        />\n      </OmniModal>\n    );\n  }\n}\n\nOmniContainer.propTypes = propTypes;\nexport default OmniContainer;\n"]},"metadata":{},"sourceType":"module"}